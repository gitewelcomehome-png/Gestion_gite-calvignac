<div class="card">
    <div class="card-header">
        <span class="card-icon">üí∞</span>
        <h2 class="card-title">Calculateur Fiscal LMP</h2>
        <p style="color: #7f8c8d; font-size: 0.9rem; margin: 8px 0 0 0;">Optimisez votre d√©claration et calculez vos charges d√©ductibles</p>
    </div>

    <!-- Boutons de gestion -->
    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
        <button onclick="chargerDerniereSimulation()" class="btn btn-secondary">
            üìÇ Charger derni√®re simulation
        </button>
        <button onclick="nouvelleSimulation()" class="btn btn-secondary">
            üîÑ Nouvelle simulation
        </button>
        <button onclick="sauvegarderSimulation()" class="btn btn-primary">
            üíæ Sauvegarder
        </button>
    </div>

    <form id="calculateur-lmp" onsubmit="calculerFiscalite(event)">
        
        <!-- BLOC 1 : Chiffre d'affaires -->
        <div class="fiscal-bloc">
            <h3 class="fiscal-bloc-title">üìä Chiffre d'affaires</h3>
            <div class="form-group">
                <label>Chiffre d'affaires annuel (‚Ç¨) <span class="required">*</span></label>
                <input type="number" id="ca" step="0.01" required placeholder="Ex: 25000">
            </div>
        </div>

        <!-- BLOC 2A : Charges COUZON -->
        <div class="fiscal-bloc">
            <h3 class="fiscal-bloc-title">üè† Charges COUZON (100% d√©ductibles)</h3>
            <div class="fiscal-grid">
                <div class="form-group">
                    <label>Internet</label>
                    <div class="input-with-select">
                        <select id="internet_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="internet_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Eau</label>
                    <div class="input-with-select">
                        <select id="eau_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="eau_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>√âlectricit√©</label>
                    <div class="input-with-select">
                        <select id="electricite_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="electricite_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance habitation</label>
                    <div class="input-with-select">
                        <select id="assurance_hab_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="assurance_hab_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance emprunteur</label>
                    <div class="input-with-select">
                        <select id="assurance_emprunt_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="assurance_emprunt_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Int√©r√™ts emprunt</label>
                    <div class="input-with-select">
                        <select id="interets_emprunt_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="interets_emprunt_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>M√©nage/Entretien</label>
                    <div class="input-with-select">
                        <select id="menage_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="menage_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Linge (draps, serviettes)</label>
                    <div class="input-with-select">
                        <select id="linge_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="linge_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Logiciel de gestion</label>
                    <div class="input-with-select">
                        <select id="logiciel_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="logiciel_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Charges de copropri√©t√©</label>
                    <div class="input-with-select">
                        <select id="copropriete_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="copropriete_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Taxe fonci√®re (annuel)</label>
                    <input type="number" id="taxe_fonciere_couzon" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>CFE (annuel)</label>
                    <input type="number" id="cfe_couzon" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Commissions plateformes (annuel)</label>
                    <input type="number" id="commissions_couzon" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Amortissement du bien (annuel)</label>
                    <input type="number" id="amortissement_couzon" step="0.01" placeholder="0.00">
                </div>
            </div>
        </div>

        <!-- BLOC 2B : Charges TR√âVOUX -->
        <div class="fiscal-bloc">
            <h3 class="fiscal-bloc-title">üè† Charges TR√âVOUX (100% d√©ductibles)</h3>
            <div class="fiscal-grid">
                <div class="form-group">
                    <label>Internet</label>
                    <div class="input-with-select">
                        <select id="internet_trevoux_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="internet_trevoux" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Eau</label>
                    <div class="input-with-select">
                        <select id="eau_trevoux_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="eau_trevoux" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>√âlectricit√©</label>
                    <div class="input-with-select">
                        <select id="electricite_trevoux_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="electricite_trevoux" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance habitation</label>
                    <div class="input-with-select">
                        <select id="assurance_hab_trevoux_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="assurance_hab_trevoux" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance emprunteur</label>
                    <div class="input-with-select">
                        <select id="assurance_emprunt_trevoux_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="assurance_emprunt_trevoux" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Int√©r√™ts emprunt</label>
                    <div class="input-with-select">
                        <select id="interets_emprunt_trevoux_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="interets_emprunt_trevoux" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>M√©nage/Entretien</label>
                    <div class="input-with-select">
                        <select id="menage_trevoux_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="menage_trevoux" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Linge (draps, serviettes)</label>
                    <div class="input-with-select">
                        <select id="linge_trevoux_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="linge_trevoux" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Logiciel de gestion</label>
                    <div class="input-with-select">
                        <select id="logiciel_trevoux_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="logiciel_trevoux" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Charges de copropri√©t√©</label>
                    <div class="input-with-select">
                        <select id="copropriete_trevoux_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="copropriete_trevoux" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Taxe fonci√®re (annuel)</label>
                    <input type="number" id="taxe_fonciere_trevoux" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>CFE (annuel)</label>
                    <input type="number" id="cfe_trevoux" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Commissions plateformes (annuel)</label>
                    <input type="number" id="commissions_trevoux" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Amortissement du bien (annuel)</label>
                    <input type="number" id="amortissement_trevoux" step="0.01" placeholder="0.00">
                </div>
            </div>
        </div>

        <!-- BLOC 2C : Travaux (Liste dynamique) -->
        <div class="fiscal-bloc">
            <h3 class="fiscal-bloc-title">üîß Travaux/R√©parations</h3>
            <div style="margin-bottom: 15px;">
                <button type="button" onclick="ajouterTravaux()" class="btn btn-secondary">‚ûï Ajouter un travail</button>
            </div>
            <div id="travaux-liste" style="display: grid; gap: 10px;"></div>
        </div>

        <!-- BLOC 2D : Frais divers (Liste dynamique) -->
        <div class="fiscal-bloc">
            <h3 class="fiscal-bloc-title">üìù Frais divers</h3>
            <div style="margin-bottom: 15px;">
                <button type="button" onclick="ajouterFraisDivers()" class="btn btn-secondary">‚ûï Ajouter un frais</button>
            </div>
            <div id="frais-divers-liste" style="display: grid; gap: 10px;"></div>
        </div>

        <!-- BLOC 2E : Produits d'accueil (Liste dynamique) -->
        <div class="fiscal-bloc">
            <h3 class="fiscal-bloc-title">üß¥ Produits d'accueil</h3>
            <div style="margin-bottom: 15px;">
                <button type="button" onclick="ajouterProduitAccueil()" class="btn btn-secondary">‚ûï Ajouter un produit</button>
            </div>
            <div id="produits-accueil-liste" style="display: grid; gap: 10px;"></div>
        </div>

        <!-- BLOC 3 : R√©sidence principale (Bureau) -->
        <div class="fiscal-bloc">
            <h3 class="fiscal-bloc-title">üè° Charges r√©sidence principale (Bureau)</h3>
            <p class="fiscal-info">‚ö†Ô∏è D√©ductibles au prorata de la surface professionnelle</p>
            
            <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 10px;">
                    <div class="form-group">
                        <label>Surface bureau (m¬≤)</label>
                        <input type="number" id="surface_bureau" step="0.01" placeholder="15" onchange="calculerRatio()">
                    </div>
                    <div class="form-group">
                        <label>Surface totale logement (m¬≤)</label>
                        <input type="number" id="surface_totale" step="0.01" placeholder="100" onchange="calculerRatio()">
                    </div>
                </div>
                <div id="ratio-display" style="font-size: 1.2rem; font-weight: 600; color: #27ae60; text-align: center;">
                    Ratio : 0%
                </div>
            </div>
            
            <div class="fiscal-grid">
                <div class="form-group">
                    <label>Int√©r√™ts emprunt r√©sidence</label>
                    <div class="input-with-select">
                        <select id="interets_residence_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="interets_residence" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance emprunteur r√©sidence</label>
                    <div class="input-with-select">
                        <select id="assurance_residence_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="assurance_residence" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>√âlectricit√© r√©sidence</label>
                    <div class="input-with-select">
                        <select id="electricite_residence_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="electricite_residence" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Internet r√©sidence</label>
                    <div class="input-with-select">
                        <select id="internet_residence_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="internet_residence" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Eau r√©sidence</label>
                    <div class="input-with-select">
                        <select id="eau_residence_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="eau_residence" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance habitation r√©sidence</label>
                    <div class="input-with-select">
                        <select id="assurance_hab_residence_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="assurance_hab_residence" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Taxe fonci√®re r√©sidence (annuel)</label>
                    <input type="number" id="taxe_fonciere_residence" step="0.01" placeholder="0.00">
                </div>
            </div>
        </div>

        <!-- BLOC 4 : Frais professionnels -->
        <div class="fiscal-bloc">
            <h3 class="fiscal-bloc-title">üíº Frais professionnels (100% d√©ductibles)</h3>
            <div class="fiscal-grid">
                <div class="form-group">
                    <label>Comptable (annuel)</label>
                    <input type="number" id="comptable" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Frais bancaires (annuel)</label>
                    <input type="number" id="frais_bancaires" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>T√©l√©phone</label>
                    <div class="input-with-select">
                        <select id="telephone_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="telephone" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Mat√©riel informatique (annuel)</label>
                    <input type="number" id="materiel_info" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>RC Professionnelle (annuel)</label>
                    <input type="number" id="rc_pro" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Formation (annuel)</label>
                    <input type="number" id="formation" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Fournitures</label>
                    <div class="input-with-select">
                        <select id="fournitures_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="fournitures" step="0.01" placeholder="0.00">
                    </div>
                </div>
            </div>
        </div>

        <!-- BLOC 5 : V√©hicule -->
        <div class="fiscal-bloc">
            <h3 class="fiscal-bloc-title">üöó Frais de v√©hicule</h3>
            <div style="margin-bottom: 20px;">
                <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <input type="radio" name="vehicule_option" value="bareme" checked onchange="toggleVehiculeOption()"> 
                    Bar√®me kilom√©trique 2024
                </label>
                <label style="display: flex; align-items: center; gap: 10px;">
                    <input type="radio" name="vehicule_option" value="reel" onchange="toggleVehiculeOption()"> 
                    Frais r√©els
                </label>
            </div>

            <div id="vehicule-bareme" class="fiscal-grid">
                <div class="form-group">
                    <label>Puissance fiscale (CV)</label>
                    <select id="puissance_fiscale">
                        <option value="3">3 CV</option>
                        <option value="4">4 CV</option>
                        <option value="5" selected>5 CV</option>
                        <option value="6">6 CV</option>
                        <option value="7">7 CV et +</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Kilom√®tres professionnels</label>
                    <input type="number" id="km_professionnels" step="1" placeholder="5000">
                </div>
            </div>

            <div id="vehicule-reel" class="fiscal-grid" style="display: none;">
                <div class="form-group">
                    <label>Carburant</label>
                    <div class="input-with-select">
                        <select id="carburant_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="carburant" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance auto</label>
                    <div class="input-with-select">
                        <select id="assurance_auto_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="assurance_auto" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Entretien/r√©parations (annuel)</label>
                    <input type="number" id="entretien_auto" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Amortissement v√©hicule (annuel)</label>
                    <input type="number" id="amortissement_auto" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Usage professionnel (%)</label>
                    <input type="number" id="usage_pro_pourcent" step="1" min="0" max="100" placeholder="50">
                </div>
            </div>
        </div>

        <!-- Bouton Calculer -->
        <div style="text-align: center; margin-top: 30px;">
            <button type="submit" class="btn btn-primary" style="font-size: 1.2rem; padding: 15px 40px;">
                üî¢ CALCULER
            </button>
        </div>
    </form>

    <!-- R√©sultats -->
    <div id="resultats-fiscalite" style="display: none; margin-top: 30px;"></div>
</div>

<style>
.fiscal-bloc {
    background: white;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.fiscal-bloc-title {
    font-size: 1.4rem;
    color: var(--primary);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.fiscal-info {
    background: #fff3cd;
    border-left: 4px solid #ffc107;
    color: #856404;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 15px;
    font-size: 0.9rem;
}

.fiscal-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
}

.input-with-select {
    display: flex;
    gap: 8px;
    align-items: center;
}

.type-select {
    min-width: 85px;
    max-width: 85px;
    padding: 8px 4px;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 0.85rem;
    flex-shrink: 0;
}

.input-with-select input {
    flex: 1;
    min-width: 0;
}

.liste-item {
    display: grid;
    grid-template-columns: 1fr 120px 150px 40px;
    gap: 10px;
    align-items: center;
    background: #f8f9fa;
    padding: 10px;
    border-radius: 8px;
    border-left: 4px solid var(--primary);
}

.liste-item input,
.liste-item select {
    padding: 8px;
    border: 2px solid #ddd;
    border-radius: 6px;
}

.liste-item button {
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    cursor: pointer;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.liste-item button:hover {
    background: #c0392b;
}

#resultats-content {
    background: rgba(255,255,255,0.1);
    padding: 20px;
    border-radius: 8px;
}

.resultat-ligne {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.2);
}

.resultat-ligne.total {
    font-size: 1.3rem;
    font-weight: 700;
    border-top: 2px solid white;
    border-bottom: 2px solid white;
    margin: 10px 0;
}

.resultat-section {
    margin: 20px 0;
}

.resultat-section h4 {
    color: white;
    font-size: 1.1rem;
    margin-bottom: 10px;
}
</style>
