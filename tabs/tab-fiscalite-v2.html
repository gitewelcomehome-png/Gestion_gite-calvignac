<div class="card">
    <div class="card-header">
        <span class="card-icon">üí∞</span>
        <h2 class="card-title">Calculateur Fiscal LMP</h2>
        <p style="color: #7f8c8d; font-size: 0.9rem; margin: 8px 0 0 0;">Optimisez votre d√©claration et calculez vos charges d√©ductibles</p>
    </div>

    <!-- Boutons de gestion -->
    <div style="display: flex; gap: 10px; margin-bottom: 20px; justify-content: flex-end;">
        <button onclick="nouvelleSimulation()" class="btn btn-secondary" title="Nouvelle simulation" style="padding: 10px 15px;">
            üîÑ
        </button>
    </div>

    <form id="calculateur-lmp" onsubmit="calculerFiscalite(event)">
        
        <!-- BLOC ANN√âE -->
        <div class="fiscal-bloc">
            <div class="bloc-content" style="margin-top: 0;">
                <div class="form-group">
                    <label>Ann√©e de la simulation <span class="required">*</span></label>
                    <input type="number" id="annee_simulation" min="2020" max="2050" required placeholder="Ex: 2026" style="max-width: 150px;">
                </div>
            </div>
        </div>
        
        <!-- BLOC 1 : Chiffre d'affaires -->
        <div class="fiscal-bloc collapsible">
            <h3 class="fiscal-bloc-title" onclick="toggleBloc(this)">
                <span class="toggle-icon">‚ñº</span> üìä Chiffre d'affaires
            </h3>
            <div class="bloc-content">
                <div class="form-group">
                    <label>Chiffre d'affaires annuel (‚Ç¨) <span class="required">*</span></label>
                    <input type="number" id="ca" step="0.01" required placeholder="Ex: 25000">
                </div>
            </div>
        </div>

        <!-- BLOC 2A : Charges COUZON -->
        <div class="fiscal-bloc collapsible">
            <h3 class="fiscal-bloc-title" onclick="toggleBloc(this)">
                <span class="toggle-icon">‚ñº</span> üè† Charges COUZON (100% d√©ductibles)
            </h3>
            <div class="bloc-content">
            <div class="fiscal-grid">
                <div class="form-group">
                    <label>Internet</label>
                    <div class="input-with-select">
                        <select id="internet_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="internet_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Eau</label>
                    <div class="input-with-select">
                        <select id="eau_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="eau_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>√âlectricit√©</label>
                    <div class="input-with-select">
                        <select id="electricite_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="electricite_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance habitation</label>
                    <div class="input-with-select">
                        <select id="assurance_hab_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="assurance_hab_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance emprunteur</label>
                    <div class="input-with-select">
                        <select id="assurance_emprunt_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="assurance_emprunt_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Int√©r√™ts emprunt</label>
                    <div class="input-with-select">
                        <select id="interets_emprunt_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="interets_emprunt_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>M√©nage/Entretien</label>
                    <div class="input-with-select">
                        <select id="menage_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="menage_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Linge (draps, serviettes)</label>
                    <div class="input-with-select">
                        <select id="linge_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="linge_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Logiciel de gestion</label>
                    <div class="input-with-select">
                        <select id="logiciel_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="logiciel_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Charges de copropri√©t√©</label>
                    <div class="input-with-select">
                        <select id="copropriete_couzon_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="copropriete_couzon" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Taxe fonci√®re (annuel)</label>
                    <input type="number" id="taxe_fonciere_couzon" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>CFE (annuel)</label>
                    <input type="number" id="cfe_couzon" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Commissions plateformes (annuel)</label>
                    <input type="number" id="commissions_couzon" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Amortissement du bien (annuel)</label>
                    <input type="number" id="amortissement_couzon" step="0.01" placeholder="0.00">
                </div>
            </div>
            </div>
        </div>

        <!-- BLOC 2B : Charges TR√âVOUX -->
        <div class="fiscal-bloc collapsible">
            <h3 class="fiscal-bloc-title" onclick="toggleBloc(this)"><span class="toggle-icon">‚ñº</span> üè† Charges TR√âVOUX (100% d√©ductibles)</h3>
            <div class="bloc-content">
                <div class="fiscal-grid">
                    <div class="form-group">
                        <label>Internet</label>
                        <div class="input-with-select">
                            <select id="internet_trevoux_type" class="type-select">
                                <option value="mensuel">Mensuel</option>
                                <option value="annuel">Annuel</option>
                            </select>
                            <input type="number" id="internet_trevoux" step="0.01" placeholder="0.00" oninput="calculerTempsReel()">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Eau</label>
                        <div class="input-with-select">
                            <select id="eau_trevoux_type" class="type-select">
                                <option value="mensuel">Mensuel</option>
                                <option value="annuel">Annuel</option>
                            </select>
                            <input type="number" id="eau_trevoux" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>√âlectricit√©</label>
                        <div class="input-with-select">
                            <select id="electricite_trevoux_type" class="type-select">
                                <option value="mensuel">Mensuel</option>
                                <option value="annuel">Annuel</option>
                            </select>
                            <input type="number" id="electricite_trevoux" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Assurance habitation</label>
                        <div class="input-with-select">
                            <select id="assurance_hab_trevoux_type" class="type-select">
                                <option value="mensuel">Mensuel</option>
                                <option value="annuel">Annuel</option>
                            </select>
                            <input type="number" id="assurance_hab_trevoux" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Assurance emprunteur</label>
                        <div class="input-with-select">
                            <select id="assurance_emprunt_trevoux_type" class="type-select">
                                <option value="mensuel">Mensuel</option>
                                <option value="annuel">Annuel</option>
                            </select>
                            <input type="number" id="assurance_emprunt_trevoux" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Int√©r√™ts emprunt</label>
                        <div class="input-with-select">
                            <select id="interets_emprunt_trevoux_type" class="type-select">
                                <option value="mensuel">Mensuel</option>
                                <option value="annuel">Annuel</option>
                            </select>
                            <input type="number" id="interets_emprunt_trevoux" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>M√©nage/Entretien</label>
                        <div class="input-with-select">
                            <select id="menage_trevoux_type" class="type-select">
                                <option value="mensuel">Mensuel</option>
                                <option value="annuel">Annuel</option>
                            </select>
                            <input type="number" id="menage_trevoux" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Linge (draps, serviettes)</label>
                        <div class="input-with-select">
                            <select id="linge_trevoux_type" class="type-select">
                                <option value="mensuel">Mensuel</option>
                                <option value="annuel">Annuel</option>
                            </select>
                            <input type="number" id="linge_trevoux" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Logiciel de gestion</label>
                        <div class="input-with-select">
                            <select id="logiciel_trevoux_type" class="type-select">
                                <option value="mensuel">Mensuel</option>
                                <option value="annuel">Annuel</option>
                            </select>
                            <input type="number" id="logiciel_trevoux" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Charges de copropri√©t√©</label>
                        <div class="input-with-select">
                            <select id="copropriete_trevoux_type" class="type-select">
                                <option value="mensuel">Mensuel</option>
                                <option value="annuel">Annuel</option>
                            </select>
                            <input type="number" id="copropriete_trevoux" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Taxe fonci√®re (annuel)</label>
                        <input type="number" id="taxe_fonciere_trevoux" step="0.01" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label>CFE (annuel)</label>
                        <input type="number" id="cfe_trevoux" step="0.01" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label>Commissions plateformes (annuel)</label>
                        <input type="number" id="commissions_trevoux" step="0.01" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label>Amortissement du bien (annuel)</label>
                        <input type="number" id="amortissement_trevoux" step="0.01" placeholder="0.00">
                    </div>
                </div>
            </div>
        </div>

        <!-- BLOC 2C : Travaux (Liste dynamique) -->
        <div class="fiscal-bloc collapsible">
            <h3 class="fiscal-bloc-title" onclick="toggleBloc(this)"><span class="toggle-icon">‚ñº</span> üîß Travaux/R√©parations</h3>
            <div class="bloc-content">
                <div style="margin-bottom: 15px;">
                    <button type="button" onclick="ajouterTravaux()" class="btn btn-secondary">‚ûï Ajouter un travail</button>
                </div>
                <div id="travaux-liste" style="display: grid; gap: 10px;">
                </div>
            </div>
        </div>

        <!-- BLOC 2D : Frais divers (Liste dynamique) -->
        <div class="fiscal-bloc collapsible">
            <h3 class="fiscal-bloc-title" onclick="toggleBloc(this)"><span class="toggle-icon">‚ñº</span> üìù Frais divers</h3>
            <div class="bloc-content">
                <div style="margin-bottom: 15px;">
                    <button type="button" onclick="ajouterFraisDivers()" class="btn btn-secondary">‚ûï Ajouter un frais</button>
                </div>
                <div id="frais-divers-liste" style="display: grid; gap: 10px;">
                </div>
            </div>
        </div>

        <!-- BLOC 2E : Produits d'accueil (Liste dynamique) -->
        <div class="fiscal-bloc collapsible">
            <h3 class="fiscal-bloc-title" onclick="toggleBloc(this)"><span class="toggle-icon">‚ñº</span> üß¥ Produits d'accueil</h3>
            <div class="bloc-content">
                <div style="margin-bottom: 15px;">
                <button type="button" onclick="ajouterProduitAccueil()" class="btn btn-secondary">‚ûï Ajouter un produit</button>
            </div>
            <div id="produits-accueil-liste" style="display: grid; gap: 10px;">
            </div>
            </div>
        </div>

        <!-- BLOC 3 : R√©sidence principale (Bureau) -->
        <div class="fiscal-bloc collapsible">
            <h3 class="fiscal-bloc-title" onclick="toggleBloc(this)"><span class="toggle-icon">‚ñº</span> üè° Charges r√©sidence principale (Bureau)</h3>
            <div class="bloc-content">
                <p class="fiscal-info">‚ö†Ô∏è D√©ductibles au prorata de la surface professionnelle</p>
            
                <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 10px;">
                        <div class="form-group">
                            <label>Surface bureau (m¬≤)</label>
                            <input type="number" id="surface_bureau" step="0.01" placeholder="15" onchange="calculerRatio()">
                        </div>
                        <div class="form-group">
                            <label>Surface totale logement (m¬≤)</label>
                            <input type="number" id="surface_totale" step="0.01" placeholder="100" onchange="calculerRatio()">
                        </div>
                    </div>
                    <div id="ratio-display" style="font-size: 1.2rem; font-weight: 600; color: #27ae60; text-align: center;">
                        Ratio : 0%
                    </div>
                </div>
            
                <div class="fiscal-grid">
                <div class="form-group">
                    <label>Int√©r√™ts emprunt r√©sidence</label>
                    <div class="input-with-select">
                        <select id="interets_residence_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="interets_residence" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance emprunteur r√©sidence</label>
                    <div class="input-with-select">
                        <select id="assurance_residence_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="assurance_residence" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>√âlectricit√© r√©sidence</label>
                    <div class="input-with-select">
                        <select id="electricite_residence_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="electricite_residence" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Internet r√©sidence</label>
                    <div class="input-with-select">
                        <select id="internet_residence_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="internet_residence" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Eau r√©sidence</label>
                    <div class="input-with-select">
                        <select id="eau_residence_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="eau_residence" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance habitation r√©sidence</label>
                    <div class="input-with-select">
                        <select id="assurance_hab_residence_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="assurance_hab_residence" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Taxe fonci√®re r√©sidence (annuel)</label>
                    <input type="number" id="taxe_fonciere_residence" step="0.01" placeholder="0.00">
                </div>
            </div>
            </div>
        </div>

        <!-- BLOC 4 : Frais professionnels -->
        <div class="fiscal-bloc collapsible">
            <h3 class="fiscal-bloc-title" onclick="toggleBloc(this)"><span class="toggle-icon">‚ñº</span> üíº Frais professionnels (100% d√©ductibles)</h3>
            <div class="bloc-content">
                <div class="fiscal-grid">
                <div class="form-group">
                    <label>Comptable (annuel)</label>
                    <input type="number" id="comptable" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Frais bancaires (annuel)</label>
                    <input type="number" id="frais_bancaires" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>T√©l√©phone</label>
                    <div class="input-with-select">
                        <select id="telephone_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="telephone" step="0.01" placeholder="0.00">
            </div>
        </div>
                </div>
                
                <div class="form-group">
                    <label>Mat√©riel informatique (annuel)</label>
                    <input type="number" id="materiel_info" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>RC Professionnelle (annuel)</label>
                    <input type="number" id="rc_pro" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Formation (annuel)</label>
                    <input type="number" id="formation" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Fournitures</label>
                    <div class="input-with-select">
                        <select id="fournitures_type" class="type-select">
                            <option value="mensuel">Mensuel</option>
                            <option value="annuel">Annuel</option>
                        </select>
                        <input type="number" id="fournitures" step="0.01" placeholder="0.00">
                    </div>
                </div>
            </div>
        </div>

        <!-- BLOC 5 : V√©hicule -->
        <div class="fiscal-bloc collapsible">
            <h3 class="fiscal-bloc-title" onclick="toggleBloc(this)"><span class="toggle-icon">‚ñº</span> üöó Frais de v√©hicule (Bar√®me kilom√©trique 2024)</h3>
            <div class="bloc-content">
                <div class="fiscal-grid">
                    <div class="form-group">
                        <label>Puissance fiscale (CV)</label>
                        <select id="puissance_fiscale" onchange="calculerTempsReel()">
                            <option value="3">3 CV</option>
                            <option value="4">4 CV</option>
                            <option value="5" selected>5 CV</option>
                            <option value="6">6 CV</option>
                            <option value="7">7 CV et +</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Kilom√®tres professionnels</label>
                        <input type="number" id="km_professionnels" step="1" placeholder="5000" oninput="calculerTempsReel()">
                    </div>
                </div>
            </div>
        </div>

        <!-- R√©sultats Fiscaux -->
        <div class="fiscal-bloc collapsible" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; margin-top: 30px;">
            <h3 class="fiscal-bloc-title" style="color: white; cursor: pointer;" onclick="toggleBloc(this)">
                <span class="toggle-icon">‚ñº</span> üìä R√âSULTATS FISCAUX
            </h3>
            <div class="bloc-content">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                        <div style="font-size: 0.9rem; opacity: 0.9;">B√©n√©fice imposable</div>
                        <div id="preview-benefice" style="font-size: 1.5rem; font-weight: 700;">0 ‚Ç¨</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                        <div style="font-size: 0.9rem; opacity: 0.9;">Cotisations URSSAF</div>
                        <div id="preview-urssaf" style="font-size: 1.5rem; font-weight: 700;">0 ‚Ç¨</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                        <div style="font-size: 0.9rem; opacity: 0.9;">Reste avant IR</div>
                        <div id="preview-reste" style="font-size: 1.5rem; font-weight: 700;">0 ‚Ç¨</div>
                    </div>
                </div>
                
                <!-- D√©tails des calculs URSSAF -->
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: white; margin-bottom: 15px; font-size: 1rem;">üìã D√©tails URSSAF :</h4>
                    <div style="display: grid; gap: 8px;">
                        <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;">
                            <span>Cotisations sociales (22%)</span>
                            <strong id="detail-sociales">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;">
                            <span>CSG/CRDS (9.7%)</span>
                            <strong id="detail-csg-crds">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;">
                            <span>Formation professionnelle (0.25%)</span>
                            <strong id="detail-formation-pro">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;">
                            <span>Allocations familiales (0% √† 3.1%)</span>
                            <strong id="detail-allocations">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 4px; font-weight: 600; margin-top: 5px;">
                            <span>TOTAL URSSAF</span>
                            <strong id="detail-total-urssaf">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(46, 204, 113, 0.3); border-radius: 4px; font-weight: 600; margin-top: 5px;">
                            <span>Trimestres de retraite valid√©s</span>
                            <strong id="detail-trimestres">0</strong>
                        </div>
                    </div>
                </div>
                
                <div id="alerte-retraite" style="display: none; background: #e74c3c; padding: 12px; border-radius: 8px; font-weight: 600;">
                    ‚ö†Ô∏è ATTENTION : B√©n√©fice en dessous de 7 046 ‚Ç¨ - Trimestres de retraite non valid√©s !
                </div>
            </div>
        </div>

        <!-- Calcul Imp√¥t sur le Revenu -->
        <div class="fiscal-bloc collapsible">
            <h3 class="fiscal-bloc-title" onclick="toggleBloc(this)"><span class="toggle-icon">‚ñº</span> üßæ Calcul Imp√¥t sur le Revenu (IR)</h3>
            <div class="bloc-content">
                <div class="fiscal-grid">
                    <div class="form-group">
                        <label>Salaire annuel Madame (‚Ç¨)</label>
                        <input type="number" id="salaire_madame" step="0.01" placeholder="0.00" oninput="calculerIR()">
                    </div>
                    
                    <div class="form-group">
                        <label>Salaire annuel Monsieur (‚Ç¨)</label>
                        <input type="number" id="salaire_monsieur" step="0.01" placeholder="0.00" oninput="calculerIR()">
                    </div>
                    
                    <div class="form-group">
                        <label>Revenu LMP (calcul√© automatiquement)</label>
                        <input type="number" id="revenu_lmp" step="0.01" readonly style="background: #e8f5e9; font-weight: 600;">
                    </div>
                    
                    <div class="form-group">
                        <label>Nombre d'enfants</label>
                        <select id="nombre_enfants" onchange="calculerIR()">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5+</option>
                        </select>
                    </div>
                </div>
                
                <div id="resultat-ir" style="display: none; margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: white; border-radius: 10px;">
                    <div style="display: grid; gap: 10px;">
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.3);">
                            <span>Revenu imposable total :</span>
                            <strong id="ir-revenu-total">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.3);">
                            <span>Nombre de parts fiscales :</span>
                            <strong id="ir-parts">0</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.3);">
                            <span>Quotient familial :</span>
                            <strong id="ir-quotient">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 15px 0; font-size: 1.3rem; border-top: 2px solid white; margin-top: 10px;">
                            <span>üíµ IMP√îT SUR LE REVENU :</span>
                            <strong id="ir-montant">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 8px; font-size: 1.4rem;">
                            <span>‚úÖ RESTE APR√àS IR :</span>
                            <strong id="ir-reste-final">0 ‚Ç¨</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BLOC : Reste √† vivre -->
        <div class="fiscal-bloc collapsible">
            <h3 class="fiscal-bloc-title" onclick="toggleBloc(this)">
                <span class="toggle-icon">‚ñº</span> üí∞ Reste √† vivre apr√®s cr√©dits
            </h3>
            <div class="bloc-content">
                <p style="color: #7f8c8d; margin-bottom: 20px;">Calculez votre reste √† vivre mensuel en int√©grant tous vos revenus (salaires, LMP, amortissements) et toutes vos charges (cr√©dits, frais personnels).</p>
                
                <!-- Cr√©dits en cours -->
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                    <h4 style="margin-bottom: 15px; color: #856404;">üìã Cr√©dits en cours</h4>
                    <div id="credits-liste" style="display: grid; gap: 10px; margin-bottom: 15px;">
                        <!-- Les cr√©dits seront ajout√©s ici dynamiquement -->
                    </div>
                    <button type="button" onclick="ajouterCredit()" class="btn btn-secondary" style="width: 100%;">
                        ‚ûï Ajouter un cr√©dit
                    </button>
                </div>

                <!-- Frais personnels mensuels -->
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                    <h4 style="margin-bottom: 15px; color: #1565c0;">üè† Frais personnels mensuels (maison)</h4>
                    <div class="fiscal-grid">
                        <div class="form-group">
                            <label>Internet personnel (‚Ç¨/mois)</label>
                            <input type="number" id="frais_perso_internet" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>√âlectricit√© personnel (‚Ç¨/mois)</label>
                            <input type="number" id="frais_perso_electricite" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>Eau personnel (‚Ç¨/mois)</label>
                            <input type="number" id="frais_perso_eau" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>Assurance personnel (‚Ç¨/mois)</label>
                            <input type="number" id="frais_perso_assurance" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>Taxe fonci√®re personnel (‚Ç¨/an)</label>
                            <input type="number" id="frais_perso_taxe" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>Autres frais mensuels</label>
                            <input type="number" id="frais_perso_autres" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <!-- R√©sultat Reste √† vivre -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 10px;">
                    <h4 style="color: white; margin-bottom: 20px; font-size: 1.2rem;">üìä Calcul du reste √† vivre mensuel</h4>
                    
                    <!-- Revenus -->
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: white; margin-bottom: 10px;">üí∞ REVENUS MENSUELS</h5>
                        <div style="display: grid; gap: 8px;">
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>Salaire Madame</span>
                                <strong id="rav-salaire-madame">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>Salaire Monsieur</span>
                                <strong id="rav-salaire-monsieur">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>Revenus LMP (apr√®s IR)</span>
                                <strong id="rav-lmp">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>√âconomie frais kilom√©triques</span>
                                <strong id="rav-kms">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>Amortissements r√©int√©gr√©s</span>
                                <strong id="rav-amortissements">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 10px 0; font-weight: 700; border-top: 2px solid rgba(255,255,255,0.5); margin-top: 5px;">
                                <span>TOTAL REVENUS</span>
                                <strong id="rav-total-revenus">0 ‚Ç¨</strong>
                            </div>
                        </div>
                    </div>

                    <!-- D√©penses -->
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: white; margin-bottom: 10px;">üí∏ D√âPENSES MENSUELLES</h5>
                        <div style="display: grid; gap: 8px;">
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>Cr√©dits</span>
                                <strong id="rav-credits">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>Frais personnels</span>
                                <strong id="rav-frais-perso">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 10px 0; font-weight: 700; border-top: 2px solid rgba(255,255,255,0.5); margin-top: 5px;">
                                <span>TOTAL D√âPENSES</span>
                                <strong id="rav-total-depenses">0 ‚Ç¨</strong>
                            </div>
                        </div>
                    </div>

                    <!-- R√©sultat final -->
                    <div style="background: rgba(255,255,255,0.25); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.1rem; margin-bottom: 10px;">üíµ RESTE √Ä VIVRE MENSUEL</div>
                        <div id="rav-final" style="font-size: 2.5rem; font-weight: 900;">0 ‚Ç¨</div>
                        <div id="rav-capital-total" style="font-size: 0.9rem; opacity: 0.9; margin-top: 10px;">Capital restant d√ª total : 0 ‚Ç¨</div>
                    </div>
                </div>
            </div>
        </div>

    </form>
    
    <!-- SECTION SUIVI TR√âSORERIE -->
    <div class="fiscal-bloc" style="margin-top: 40px;">
        <h3 class="fiscal-bloc-title">
            üí∞ Suivi Tr√©sorerie Mensuelle
        </h3>
        <div class="bloc-content">
            <div style="display: flex; gap: 10px; margin-bottom: 20px; align-items: center; flex-wrap: wrap;">
                <label for="annee_tresorerie" style="margin: 0;">Ann√©e :</label>
                <input type="number" id="annee_tresorerie" min="2020" max="2050" style="max-width: 120px; padding: 8px;">
                <button type="button" onclick="chargerSoldesBancaires()" class="btn btn-secondary" style="padding: 8px 15px;">üì• Charger</button>
                <button type="button" onclick="sauvegarderSoldesBancaires()" class="btn btn-primary" style="padding: 8px 15px;">üíæ Sauvegarder</button>
                <div style="margin-left: auto; display: flex; gap: 10px; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="vue_graphique" value="annee" checked onchange="afficherGraphiqueSoldes()"> Par ann√©e
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="vue_graphique" value="generale" onchange="afficherGraphiqueSoldes()"> Vue g√©n√©rale
                    </label>
                    <button type="button" onclick="afficherGraphiqueSoldes()" class="btn btn-secondary" style="padding: 8px 15px;">üìä Actualiser</button>
                </div>
            </div>
            
            <!-- Tableau de saisie mensuelle -->
            <div style="overflow-x: auto; margin-bottom: 30px;">
                <table id="tableau-soldes" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--primary); color: white;">
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Mois</th>
                            <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">Solde en banque (‚Ç¨)</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Notes</th>
                        </tr>
                    </thead>
                    <tbody id="tbody-soldes">
                        <!-- G√©n√©r√© dynamiquement par genererTableauSoldes() -->
                    </tbody>
                </table>
            </div>
            
            <!-- Graphique -->
            <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <canvas id="graphique-soldes" style="max-height: 400px;"></canvas>
            </div>
        </div>
    </div>
    
</div>

<style>
.fiscal-bloc {
    background: white;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.fiscal-bloc-title {
    font-size: 1.4rem;
    color: var(--primary);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.fiscal-info {
    background: #fff3cd;
    border-left: 4px solid #ffc107;
    color: #856404;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 15px;
    font-size: 0.9rem;
}

.fiscal-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
}

.input-with-select {
    display: flex;
    gap: 8px;
    align-items: center;
}

.type-select {
    min-width: 85px;
    max-width: 85px;
    padding: 8px 4px;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 0.85rem;
    flex-shrink: 0;
}

.input-with-select input {
    flex: 1;
    min-width: 0;
}

.liste-item {
    display: grid;
    grid-template-columns: 1fr 120px 150px 40px;
    gap: 10px;
    align-items: center;
    background: #f8f9fa;
    padding: 10px;
    border-radius: 8px;
    border-left: 4px solid var(--primary);
}

.liste-item input,
.liste-item select {
    padding: 8px;
    border: 2px solid #ddd;
    border-radius: 6px;
}

.liste-item button {
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    cursor: pointer;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.liste-item button:hover {
    background: #c0392b;
}

.credit-item {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 40px;
    gap: 10px;
    align-items: center;
    background: #fff;
    padding: 12px;
    border-radius: 8px;
    border-left: 4px solid #ffc107;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.credit-item input {
    padding: 8px;
    border: 2px solid #ddd;
    border-radius: 6px;
}

.credit-item button {
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    cursor: pointer;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.credit-item button:hover {
    background: #c0392b;
}

#resultats-content {
    background: rgba(255,255,255,0.1);
    padding: 20px;
    border-radius: 8px;
}

.resultat-ligne {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.2);
}

.resultat-ligne.total {
    font-size: 1.3rem;
    font-weight: 700;
    border-top: 2px solid white;
    border-bottom: 2px solid white;
    margin: 10px 0;
}

.resultat-section {
    margin: 20px 0;
}

.resultat-section h4 {
    color: white;
    font-size: 1.1rem;
    margin-bottom: 10px;
}

/* Blocs collapsibles */
.fiscal-bloc.collapsible .fiscal-bloc-title {
    cursor: pointer;
    user-select: none;
    transition: all 0.3s ease;
}

.fiscal-bloc.collapsible .fiscal-bloc-title:hover {
    opacity: 0.8;
}

.toggle-icon {
    display: inline-block;
    transition: transform 0.3s ease;
    margin-right: 5px;
}

.fiscal-bloc.collapsible.collapsed .toggle-icon {
    transform: rotate(-90deg);
}

.fiscal-bloc.collapsible.collapsed .bloc-content {
    display: none;
}

.bloc-content {
    margin-top: 20px;
}
</style>

<script>
function toggleBloc(titleElement) {
    const bloc = titleElement.closest('.fiscal-bloc');
    bloc.classList.toggle('collapsed');
}
</script>
