<div class="tab-container">
    <!-- Header Neo-Brutalism -->
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
            <div>
                <h2 style="margin: 0; font-size: 1.5rem; color: #2D3436; font-weight: 700; text-transform: uppercase;">üí∞ Fiscalit√© LMNP</h2>
                <p style="margin: 8px 0 0 0; font-size: 0.9rem; color: #666;">Optimisez votre d√©claration et calculez vos charges</p>
            </div>
            <div style="display: flex; gap: 10px;">
                <button type="button" onclick="debugResidence()" class="btn-neo-secondary" style="background: #ff9800; border-color: #ff9800;">
                    üêõ Debug
                </button>
                <button type="button" onclick="afficherModalOptions()" class="btn-neo-secondary">
                    ‚öôÔ∏è Options
                </button>
            </div>
        </div>
    </div>

    <!-- Barre de gestion d'ann√©es -->
    <div class="card" style="background: #f8f9fa;">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <label style="font-weight: 600; color: #2c3e50;">üìÖ Ann√©e fiscale :</label>
                <select id="annee_selector" onchange="chargerAnnee(this.value)" class="form-control">
                    <!-- Rempli dynamiquement -->
                </select>
            </div>
            <div style="display: flex; gap: 10px;">
                <button type="button" onclick="creerNouvelleAnnee()" class="btn-neo" title="Cr√©er l'ann√©e suivante">
                    ‚ûï Nouvelle Ann√©e
                </button>
            </div>
        </div>
        <div class="info-box">
            <span>‚ÑπÔ∏è CA calcul√© automatiquement | Sauvegarde automatique activ√©e</span>
        </div>
    </div>

<div class="card">

    <form id="calculateur-lmp" onsubmit="calculerFiscalite(event)">
        
        <!-- Ann√©e cach√©e (g√©r√©e par le s√©lecteur) -->
        <input type="hidden" id="annee_simulation" value=""  />
        
        <!-- BLOC 1 : Chiffre d'affaires (TOUJOURS VISIBLE) -->
        <div class="fiscal-bloc">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-size: 0.9rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 1px;">üìä Chiffre d'affaires annuel</div>
                        <div id="ca-display" style="font-size: 3rem; font-weight: 700; margin-top: 10px;">0,00 ‚Ç¨</div>
                    </div>
                </div>
            </div>
            <input type="hidden" id="ca" value="0">
        </div>

        <!-- BLOC 2 : Charges par g√Æte (g√©n√©r√© dynamiquement) -->
        <div id="gites-charges-container"></div>

        <!-- BLOC 2C : FRAIS D'EXPLOITATIONS (Englobe les 3 listes) -->
        <div class="fiscal-bloc collapsible collapsed">
            <h3 class="fiscal-bloc-title"><span class="toggle-icon">‚ñº</span> üíº FRAIS D'EXPLOITATIONS</h3>
            <div class="bloc-content">
                
                <!-- Sous-section Travaux/R√©parations -->
                <div class="exploitation-section" style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="color: #e65100; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.5rem;">üîß</span>
                        Travaux/R√©parations
                    </h4>
                    <div style="margin-bottom: 15px;">
                        <button type="button" onclick="ajouterTravaux()" class="btn btn-secondary" style="background: #ff9800; border-color: #ff9800;">
                            ‚ûï Ajouter un travail
                        </button>
                    </div>
                    <div id="travaux-liste" style="display: grid; gap: 10px;">
                    </div>
                </div>

                <!-- Sous-section Frais divers -->
                <div class="exploitation-section" style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="color: #2e7d32; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.5rem;">üìù</span>
                        Frais divers
                    </h4>
                    <div style="margin-bottom: 15px;">
                        <button type="button" onclick="ajouterFraisDivers()" class="btn btn-secondary" style="background: #4caf50; border-color: #4caf50;">
                            ‚ûï Ajouter un frais
                        </button>
                    </div>
                    <div id="frais-divers-liste" style="display: grid; gap: 10px;">
                    </div>
                </div>

                <!-- Sous-section Produits d'accueil -->
                <div class="exploitation-section" style="background: #f3e5f5; border-left: 4px solid #9c27b0; padding: 20px; border-radius: 8px;">
                    <h4 style="color: #6a1b9a; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.5rem;">üß¥</span>
                        Produits d'accueil
                    </h4>
                    <div style="margin-bottom: 15px;">
                        <button type="button" onclick="ajouterProduitAccueil()" class="btn btn-secondary" style="background: #9c27b0; border-color: #9c27b0;">
                            ‚ûï Ajouter un produit
                        </button>
                    </div>
                    <div id="produits-accueil-liste" style="display: grid; gap: 10px;">
                    </div>
                </div>

            </div>
        </div>

        <!-- BLOC 3 : R√©sidence principale (Bureau) -->
        <div class="fiscal-bloc collapsible collapsed">
            <h3 class="fiscal-bloc-title"><span class="toggle-icon">‚ñº</span> üè° Charges r√©sidence principale (Bureau)</h3>
            <div class="bloc-content">
                <p class="fiscal-info">‚ö†Ô∏è D√©ductibles au prorata de la surface professionnelle</p>
            
                <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 10px;">
                        <div class="form-group">
                            <label>Surface bureau (m¬≤)</label>
                            <input type="number" id="surface_bureau" step="0.01" placeholder="15" onchange="calculerRatio()">
                        </div>
                        <div class="form-group">
                            <label>Surface totale logement (m¬≤)</label>
                            <input type="number" id="surface_totale" step="0.01" placeholder="100" onchange="calculerRatio()">
                        </div>
                    </div>
                    <div id="ratio-display" style="font-size: 1.2rem; font-weight: 600; color: #27ae60; text-align: center;">
                        Ratio : 0%
                    </div>
                </div>
                
                <!-- Toggle Mensuel/Annuel pour toute la section -->
                <div style="margin-bottom: 20px; padding: 12px; background: #f0f0f0; border-radius: 8px; display: flex; align-items: center; gap: 15px;">
                    <label style="font-weight: 600; margin: 0;">P√©riodicit√© des charges :</label>
                    <button type="button" class="btn-toggle-period active" data-period="mensuel" data-section="residence" onclick="togglePeriodSection('residence', 'mensuel')">Mensuel</button>
                    <button type="button" class="btn-toggle-period" data-period="annuel" data-section="residence" onclick="togglePeriodSection('residence', 'annuel')">Annuel</button>
                </div>
            
                <div class="fiscal-grid">
                <div class="form-group">
                    <label>Int√©r√™ts emprunt r√©sidence</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="interets_residence" step="0.01" placeholder="0.00" data-period-type="mensuel">
                        <span class="period-label" data-target="interets_residence">mensuel</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance emprunteur r√©sidence</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="assurance_residence" step="0.01" placeholder="0.00" data-period-type="mensuel">
                        <span class="period-label" data-target="assurance_residence">mensuel</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>√âlectricit√© r√©sidence</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="electricite_residence" step="0.01" placeholder="0.00" data-period-type="mensuel">
                        <span class="period-label" data-target="electricite_residence">mensuel</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Internet r√©sidence</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="internet_residence" step="0.01" placeholder="0.00" data-period-type="mensuel">
                        <span class="period-label" data-target="internet_residence">mensuel</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Eau r√©sidence</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="eau_residence" step="0.01" placeholder="0.00" data-period-type="mensuel">
                        <span class="period-label" data-target="eau_residence">mensuel</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Assurance habitation r√©sidence</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="assurance_hab_residence" step="0.01" placeholder="0.00" data-period-type="mensuel">
                        <span class="period-label" data-target="assurance_hab_residence">mensuel</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Taxe fonci√®re r√©sidence (annuel)</label>
                    <input type="number" id="taxe_fonciere_residence" step="0.01" placeholder="0.00">
                </div>
            </div>
            </div>
        </div>

        <!-- BLOC 4 : Frais professionnels -->
        <div class="fiscal-bloc collapsible collapsed">
            <h3 class="fiscal-bloc-title"><span class="toggle-icon">‚ñº</span> üíº Frais professionnels (100% d√©ductibles)</h3>
            <div class="bloc-content">
                
                <!-- Toggle Mensuel/Annuel pour toute la section -->
                <div style="margin-bottom: 20px; padding: 12px; background: #f0f0f0; border-radius: 8px; display: flex; align-items: center; gap: 15px;">
                    <label style="font-weight: 600; margin: 0;">P√©riodicit√© des frais :</label>
                    <button type="button" class="btn-toggle-period active" data-period="mensuel" data-section="frais_pro" onclick="(function(e){e.stopPropagation(); togglePeriodSection('frais_pro', 'mensuel');})(event)">Mensuel</button>
                    <button type="button" class="btn-toggle-period" data-period="annuel" data-section="frais_pro" onclick="(function(e){e.stopPropagation(); togglePeriodSection('frais_pro', 'annuel');})(event)">Annuel</button>
                </div>
                
                <div class="fiscal-grid">
                    <div class="form-group">
                        <label>Comptable</label>
                        <input type="number" id="comptable" step="0.01" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label>Frais bancaires</label>
                        <input type="number" id="frais_bancaires" step="0.01" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label>T√©l√©phone</label>
                        <div class="input-with-select">
                            <select id="telephone_type" class="type-select">
                                <option value="mensuel">Mensuel</option>
                                <option value="annuel">Annuel</option>
                            </select>
                            <input type="number" id="telephone" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Mat√©riel informatique</label>
                        <input type="number" id="materiel_info" step="0.01" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label>RC Professionnelle</label>
                        <input type="number" id="rc_pro" step="0.01" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label>Formation</label>
                        <input type="number" id="formation" step="0.01" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label>Fournitures</label>
                        <div class="input-with-select">
                            <select id="fournitures_type" class="type-select">
                                <option value="mensuel">Mensuel</option>
                                <option value="annuel">Annuel</option>
                            </select>
                            <input type="number" id="fournitures" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BLOC 5 : V√©hicule -->
        <div class="fiscal-bloc collapsible collapsed">
            <h3 class="fiscal-bloc-title"><span class="toggle-icon">‚ñº</span> üöó Frais de v√©hicule & Kilom√®tres professionnels</h3>
            <div class="bloc-content">
                <!-- Champs cach√©s pour la compatibilit√© -->
                <input type="hidden" id="vehicule_type" value="thermique">
                <input type="hidden" id="puissance_fiscale" value="5">
                <input type="hidden" id="km_professionnels" value="0">
                <input type="hidden" id="montant_frais_km" value="0">
                
                <!-- Configuration principale -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    <!-- Configuration v√©hicule -->
                    <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(33, 150, 243, 0.15);">
                        <div style="display: flex; align-items: center; margin-bottom: 12px;">
                            <div style="font-size: 2rem; margin-right: 12px;">üöô</div>
                            <div style="flex: 1;">
                                <h4 style="margin: 0; color: #1565c0; font-size: 1.1rem; font-weight: 600;">Mon v√©hicule</h4>
                                <div id="vehicule-resume" style="margin-top: 6px; font-size: 0.9rem; color: #546e7a; font-weight: 500;">
                                    <!-- R√©sum√© rempli dynamiquement -->
                                </div>
                            </div>
                        </div>
                        <button type="button" onclick="afficherModalConfigVehicule()" class="btn-neo-secondary" style="width: 100%; justify-content: center; background: white; color: #1565c0; font-weight: 600;">
                            ‚öôÔ∏è Configurer mon v√©hicule
                        </button>
                    </div>

                    <!-- Configuration automatisation -->
                    <div style="background: linear-gradient(135deg, #fff3cd 0%, #ffe082 100%); padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(255, 193, 7, 0.15);">
                        <div style="display: flex; align-items: center; margin-bottom: 12px;">
                            <div style="font-size: 2rem; margin-right: 12px;">‚ö°</div>
                            <div style="flex: 1;">
                                <h4 style="margin: 0; color: #f57c00; font-size: 1.1rem; font-weight: 600;">Automatisation</h4>
                                <p style="margin: 6px 0 0; font-size: 0.85rem; color: #795548;">G√©n√©rer vos trajets automatiquement</p>
                            </div>
                        </div>
                        <button type="button" onclick="afficherModalConfigKm()" class="btn-neo-secondary" style="width: 100%; justify-content: center; background: white; color: #f57c00; font-weight: 600;">
                            ‚öôÔ∏è Configurer l'automatisation
                        </button>
                    </div>
                </div>

                <!-- R√©sum√© annuel -->
                <div id="km-resume-annuel" style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); padding: 20px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 2px 8px rgba(76, 175, 80, 0.15);">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center;">
                        <div>
                            <div style="font-size: 0.85rem; color: #2e7d32; font-weight: 600; margin-bottom: 6px; text-transform: uppercase;">Distance totale</div>
                            <div id="km-total-annuel" style="font-size: 2rem; font-weight: 700; color: #1b5e20;">0 km</div>
                        </div>
                        <div>
                            <div style="font-size: 0.85rem; color: #2e7d32; font-weight: 600; margin-bottom: 6px; text-transform: uppercase;">Nombre de trajets</div>
                            <div id="km-nombre-trajets" style="font-size: 2rem; font-weight: 700; color: #1b5e20;">0</div>
                        </div>
                        <div>
                            <div style="font-size: 0.85rem; color: #2e7d32; font-weight: 600; margin-bottom: 6px; text-transform: uppercase;">Montant d√©ductible</div>
                            <div id="km-montant-total" style="font-size: 2rem; font-weight: 700; color: #1b5e20;">0,00 ‚Ç¨</div>
                        </div>
                    </div>
                </div>

                <!-- Gestion des trajets -->
                <div style="background: white; padding: 20px; border-radius: 12px; border: 2px solid #e0e0e0; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <!-- Header avec actions -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #f5f5f5;">
                        <h4 style="margin: 0; color: #2c3e50; font-size: 1.1rem; font-weight: 600;">
                            üóìÔ∏è Historique des trajets
                        </h4>
                        <div style="display: flex; gap: 10px;">
                            <button type="button" onclick="afficherModalLieuxFavoris()" class="btn-neo-secondary">
                                üìç G√©rer mes lieux
                            </button>
                            <button type="button" onclick="afficherModalAjoutTrajet()" class="btn-neo">
                                ‚ûï Ajouter un trajet
                            </button>
                        </div>
                    </div>
                    
                    <!-- R√©sum√© mensuel -->
                    <div id="km-resume-mensuel" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <!-- Cartes mensuelles avec bouton Voir -->
                    </div>
                    
                    <!-- Liste des trajets (masqu√©e par d√©faut) -->
                    <div id="km-liste-trajets" style="display: none; gap: 10px; max-height: 450px; overflow-y: auto; margin-top: 20px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                        <!-- Trajets affich√©s quand on clique sur Voir -->
                    </div>
                    
                    <!-- Footer avec export -->
                    <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; padding-top: 15px; border-top: 2px solid #f5f5f5;">
                        <button type="button" onclick="exporterTrajetsCSV()" class="btn-neo-secondary">
                            üìä Exporter en Excel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- R√©sultats Fiscaux -->
        <div class="fiscal-bloc collapsible collapsed" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; margin-top: 30px;">
            <h3 class="fiscal-bloc-title" style="color: white !important; cursor: pointer; text-shadow: 0 2px 4px rgba(0,0,0,0.3) !important; font-weight: 700 !important; background: transparent !important; border-bottom: none !important;">
                <span class="toggle-icon">‚ñº</span> üìä R√âSULTATS FISCAUX
            </h3>
            <div class="bloc-content">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                        <div style="font-size: 0.9rem; opacity: 0.9;">B√©n√©fice imposable</div>
                        <div id="preview-benefice" style="font-size: 1.5rem; font-weight: 700;">0 ‚Ç¨</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                        <div style="font-size: 0.9rem; opacity: 0.9;">Cotisations URSSAF</div>
                        <div id="preview-urssaf" style="font-size: 1.5rem; font-weight: 700;">0 ‚Ç¨</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                        <div style="font-size: 0.9rem; opacity: 0.9;">Reste avant IR</div>
                        <div id="preview-reste" style="font-size: 1.5rem; font-weight: 700;">0 ‚Ç¨</div>
                    </div>
                </div>
                
                <!-- D√©tails des calculs URSSAF -->
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: white; margin-bottom: 15px; font-size: 1rem;">üìã D√©tails URSSAF :</h4>
                    <div style="display: grid; gap: 8px;">
                        <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;">
                            <span>Indemnit√©s journali√®res (0.85%)</span>
                            <strong id="detail-indemnites">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;">
                            <span>Retraite de base (17.75%)</span>
                            <strong id="detail-retraite-base">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;">
                            <span>Retraite compl√©mentaire (7%)</span>
                            <strong id="detail-retraite-compl">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;">
                            <span>Invalidit√©-D√©c√®s (1.3%)</span>
                            <strong id="detail-invalidite">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;">
                            <span>CSG/CRDS (9.7%)</span>
                            <strong id="detail-csg-crds">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;">
                            <span>Formation professionnelle (0.25%)</span>
                            <strong id="detail-formation-pro">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;">
                            <span>Allocations familiales (0% √† 3.1%)</span>
                            <strong id="detail-allocations">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 4px; font-weight: 600; margin-top: 5px;">
                            <span>TOTAL URSSAF</span>
                            <strong id="detail-total-urssaf">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(46, 204, 113, 0.3); border-radius: 4px; font-weight: 600; margin-top: 5px;">
                            <span>Trimestres de retraite valid√©s</span>
                            <strong id="detail-trimestres">0</strong>
                        </div>
                    </div>
                    <div style="background: rgba(52, 152, 219, 0.2); padding: 10px; border-radius: 4px; font-size: 0.85rem; margin-top: 10px; border-left: 3px solid #3498db;">
                        üí° <strong>R√©gime LMP au r√©el :</strong> Les cotisations sont calcul√©es uniquement sur le b√©n√©fice imposable. Les taux sont mis √† jour automatiquement selon l'ann√©e en cours.
                    </div>
                </div>
                
                <div id="alerte-retraite" style="display: none; background: #e74c3c; padding: 12px; border-radius: 8px; font-weight: 600;">
                    ‚ö†Ô∏è ATTENTION : B√©n√©fice en dessous de 7 046 ‚Ç¨ - Trimestres de retraite non valid√©s !
                </div>
            </div>
        </div>

        <!-- ========== SECTION PERSONNELLE (optionnelle) ========== -->
        <div id="section-personnelle" style="display: none;">
        
        <!-- Calcul Imp√¥t sur le Revenu -->
        <div class="fiscal-bloc collapsible collapsed">
            <h3 class="fiscal-bloc-title"><span class="toggle-icon">‚ñº</span> üßæ Calcul Imp√¥t sur le Revenu (IR)</h3>
            <div class="bloc-content">
                <div class="fiscal-grid">
                    <div class="form-group">
                        <label>Salaire annuel Madame (‚Ç¨)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="salaire_madame" step="0.01" placeholder="0.00" oninput="calculerIR()" style="flex: 1;">
                            <button type="button" onclick="openFraisReelsSalarieModal('madame')" style="padding: 8px 16px; background: #2196f3; color: white; border: none; border-radius: 6px; cursor: pointer; white-space: nowrap;">
                                ‚öôÔ∏è Frais
                            </button>
                        </div>
                        <div id="frais-madame-info" style="display: none; margin-top: 5px; font-size: 0.85rem; color: #666; padding: 5px 10px; background: #e3f2fd; border-radius: 4px;">
                            <strong>D√©duction :</strong> <span id="frais-madame-montant">0 ‚Ç¨</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Salaire annuel Monsieur (‚Ç¨)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="salaire_monsieur" step="0.01" placeholder="0.00" oninput="calculerIR()" style="flex: 1;">
                            <button type="button" onclick="openFraisReelsSalarieModal('monsieur')" style="padding: 8px 16px; background: #2196f3; color: white; border: none; border-radius: 6px; cursor: pointer; white-space: nowrap;">
                                ‚öôÔ∏è Frais
                            </button>
                        </div>
                        <div id="frais-monsieur-info" style="display: none; margin-top: 5px; font-size: 0.85rem; color: #666; padding: 5px 10px; background: #e3f2fd; border-radius: 4px;">
                            <strong>D√©duction :</strong> <span id="frais-monsieur-montant">0 ‚Ç¨</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Revenu LMP (calcul√© automatiquement)</label>
                        <input type="number" id="revenu_lmp" step="0.01" readonly style="background: #e8f5e9; font-weight: 600;">
                    </div>
                    
                    <div class="form-group">
                        <label>Nombre d'enfants</label>
                        <select id="nombre_enfants" onchange="calculerIR()">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5+</option>
                        </select>
                    </div>
                </div>
                
                <!-- Champs cach√©s pour compatibilit√© - SUPPRIM√âS -->
                
                <div id="resultat-ir" style="display: none; margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: white; border-radius: 10px;">
                    <div style="display: grid; gap: 10px;">
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.3);">
                            <span>Revenu imposable total :</span>
                            <strong id="ir-revenu-total">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.3);">
                            <span>Nombre de parts fiscales :</span>
                            <strong id="ir-parts">0</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.3);">
                            <span>Quotient familial :</span>
                            <strong id="ir-quotient">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 15px 0; font-size: 1.3rem; border-top: 2px solid white; margin-top: 10px;">
                            <span>üíµ IMP√îT SUR LE REVENU :</span>
                            <strong id="ir-montant">0 ‚Ç¨</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 8px; font-size: 1.4rem;">
                            <span>‚úÖ RESTE APR√àS IR :</span>
                            <strong id="ir-reste-final">0 ‚Ç¨</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BLOC : Cr√©dits personnels (section personnelle) -->
        <div class="fiscal-bloc collapsible collapsed">
            <h3 class="fiscal-bloc-title"><span class="toggle-icon">‚ñº</span> üí≥ Cr√©dits personnels</h3>
            <div class="bloc-content">
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="margin: 0; color: #856404; font-size: 0.95rem;">
                        ‚ÑπÔ∏è Enregistrez vos cr√©dits mensuels personnels (immobilier, auto, conso...) pour calculer votre reste √† vivre.
                    </p>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="margin: 0; color: #2c3e50;">üìã Liste des cr√©dits</h4>
                    <button type="button" onclick="ajouterLigneCredit()" class="btn-neo">
                        ‚ûï Ajouter un cr√©dit
                    </button>
                </div>

                <!-- Liste des cr√©dits -->
                <div id="liste-credits-personnels" style="display: grid; gap: 10px; margin-bottom: 20px;">
                    <!-- Lignes g√©n√©r√©es dynamiquement -->
                </div>

                <!-- R√©capitulatif -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">üí≥ Total mensuel des cr√©dits personnels</div>
                            <div id="total-credits-display" style="font-size: 2rem; font-weight: 700; margin-top: 5px;">0.00 ‚Ç¨</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BLOC : Total Charges Annuelles -->
        <div class="fiscal-bloc collapsible collapsed" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: white; margin-top: 30px;">
            <h3 class="fiscal-bloc-title" style="color: white !important; cursor: pointer; text-shadow: 0 2px 4px rgba(0,0,0,0.3) !important; font-weight: 700 !important; background: transparent !important; border-bottom: none !important;">
                <span class="toggle-icon">‚ñº</span> üíº TOTAL CHARGES ANNUELLES
            </h3>
            <div class="bloc-content">
                <p style="color: white; opacity: 0.9; margin-bottom: 20px;">R√©capitulatif de toutes les charges pour le calcul du b√©n√©fice</p>
                
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <div id="total-charges-container" style="display: grid; gap: 8px;">
                        <!-- Les charges par g√Æte seront g√©n√©r√©es dynamiquement -->
                    </div>
                </div>
            </div>
        </div>

        <!-- BLOC : Reste √† vivre -->
        <div class="fiscal-bloc collapsible collapsed">
            <h3 class="fiscal-bloc-title" style="font-weight: 700;">
                <span class="toggle-icon">‚ñº</span> üí∞ Reste √† vivre apr√®s cr√©dits
            </h3>
            <div class="bloc-content">
                <p style="color: #7f8c8d; margin-bottom: 20px;">Calculez votre reste √† vivre mensuel en int√©grant tous vos revenus (salaires, LMP, amortissements) et toutes vos charges (cr√©dits, frais personnels).</p>
                
                <!-- Frais personnels mensuels -->
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                    <h4 style="margin-bottom: 15px; color: #1565c0;">üè† Frais personnels mensuels (maison)</h4>
                    <div class="fiscal-grid">
                        <div class="form-group">
                            <label>Internet personnel (‚Ç¨/mois)</label>
                            <input type="number" id="frais_perso_internet" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>√âlectricit√© personnel (‚Ç¨/mois)</label>
                            <input type="number" id="frais_perso_electricite" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>Eau personnel (‚Ç¨/mois)</label>
                            <input type="number" id="frais_perso_eau" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>Assurance personnel (‚Ç¨/mois)</label>
                            <input type="number" id="frais_perso_assurance" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>Taxe fonci√®re personnel (‚Ç¨/an)</label>
                            <input type="number" id="frais_perso_taxe" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>Autres frais mensuels</label>
                            <input type="number" id="frais_perso_autres" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <!-- R√©sultat Reste √† vivre -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 10px;">
                    <h4 style="color: white; margin-bottom: 20px; font-size: 1.2rem;">üìä Calcul du reste √† vivre mensuel</h4>
                    
                    <!-- Revenus -->
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: white; margin-bottom: 10px;">üí∞ REVENUS MENSUELS</h5>
                        <div style="display: grid; gap: 8px;">
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>Salaire Madame</span>
                                <strong id="rav-salaire-madame">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>Salaire Monsieur</span>
                                <strong id="rav-salaire-monsieur">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>Revenus LMP (apr√®s IR)</span>
                                <strong id="rav-lmp">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>√âconomie frais kilom√©triques</span>
                                <strong id="rav-kms">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>Amortissements r√©int√©gr√©s</span>
                                <strong id="rav-amortissements">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 10px 0; font-weight: 700; border-top: 2px solid rgba(255,255,255,0.5); margin-top: 5px;">
                                <span>TOTAL REVENUS</span>
                                <strong id="rav-total-revenus">0 ‚Ç¨</strong>
                            </div>
                        </div>
                    </div>

                    <!-- D√©penses -->
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: white; margin-bottom: 10px;">üí∏ D√âPENSES MENSUELLES</h5>
                        <div style="display: grid; gap: 8px;">
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>Cr√©dits</span>
                                <strong id="rav-credits">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                                <span>Frais personnels</span>
                                <strong id="rav-frais-perso">0 ‚Ç¨</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 10px 0; font-weight: 700; border-top: 2px solid rgba(255,255,255,0.5); margin-top: 5px;">
                                <span>TOTAL D√âPENSES</span>
                                <strong id="rav-total-depenses">0 ‚Ç¨</strong>
                            </div>
                        </div>
                    </div>

                    <!-- R√©sultat final -->
                    <div style="background: rgba(255,255,255,0.25); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.1rem; margin-bottom: 10px;">üíµ RESTE √Ä VIVRE MENSUEL</div>
                        <div id="rav-final" style="font-size: 2.5rem; font-weight: 900;">0 ‚Ç¨</div>
                        <div id="rav-capital-total" style="font-size: 0.9rem; opacity: 0.9; margin-top: 10px;">Capital restant d√ª total : 0 ‚Ç¨</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SECTION SUIVI TR√âSORERIE (simplifi√©e) -->
        <div class="fiscal-bloc collapsible collapsed" style="margin-top: 30px;">
            <h3 class="fiscal-bloc-title"><span class="toggle-icon">‚ñº</span> üí∞ Suivi Tr√©sorerie Mensuelle</h3>
            <div class="bloc-content">
                <p style="color: #7f8c8d; margin-bottom: 20px;">Ajoutez vos soldes mensuels pour alimenter le graphique du dashboard.</p>
                
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button type="button" onclick="afficherModalAjoutSolde()" class="btn-neo">
                        ‚ûï Ajouter un solde
                    </button>
                    <button type="button" onclick="afficherHistoriqueSoldes()" class="btn-neo-secondary">
                        üëÅÔ∏è Voir l'historique
                    </button>
                    <button type="button" onclick="exporterSoldesCSV()" class="btn-neo-secondary">
                        üì• Exporter
                    </button>
                </div>
            </div>
        </div>
        
        </div>
        <!-- ========== FIN SECTION PERSONNELLE ========== -->

    </form>
    
</div>

<!-- ==========================================
     MODAL OPTIONS PERSONNELLES
     ========================================== -->
<div id="modal-options" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #2D3436;">
            <h3 style="margin: 0; color: #2D3436;">‚öôÔ∏è Options personnelles</h3>
            <button onclick="fermerModalOptions()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
        </div>
        
        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <p style="margin: 0; color: #856404; font-size: 0.9rem;">
                üí° Activez les options personnelles pour acc√©der aux calculs d'imp√¥ts, cr√©dits et reste √† vivre.
            </p>
        </div>
        
        <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; margin-bottom: 20px;">
            <label style="display: flex; align-items: center; gap: 15px; cursor: pointer; font-size: 1rem;">
                <input type="checkbox" id="checkbox-activer-perso" onchange="toggleOptionsPersonnelles()" style="width: 24px; height: 24px; cursor: pointer;">
                <span style="font-weight: 600;">‚úÖ Activer les options personnelles</span>
            </label>
            <p style="margin: 10px 0 0 39px; font-size: 0.85rem; color: #666;">
                Inclut : Imp√¥t sur le revenu, Cr√©dits personnels, Reste √† vivre, Tr√©sorerie mensuelle
            </p>
        </div>
        
        <div style="display: flex; justify-content: flex-end;">
            <button type="button" onclick="fermerModalOptions()" class="btn-neo">‚úì Valider</button>
        </div>
    </div>
</div>

<!-- ==========================================
     MODALS - GESTION TR√âSORERIE
     ========================================== -->

<!-- Modal : Ajouter un solde -->
<div id="modal-ajout-solde" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #2D3436;">
            <h3 style="margin: 0; color: #2D3436;">üí∞ Ajouter un solde bancaire</h3>
            <button onclick="fermerModalAjoutSolde()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
        </div>
        
        <div class="fiscal-grid" style="gap: 15px;">
            <div class="form-group">
                <label>Date du relev√© *</label>
                <input type="date" id="modal-solde-date" required style="padding: 10px; border: 2px solid #ddd; border-radius: 6px;">
            </div>
            
            <div class="form-group">
                <label>Solde bancaire (‚Ç¨) *</label>
                <input type="number" id="modal-solde-montant" step="0.01" required placeholder="0.00" style="padding: 10px; border: 2px solid #ddd; border-radius: 6px; text-align: right;">
            </div>
        </div>
        
        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
            <button type="button" onclick="fermerModalAjoutSolde()" class="btn-neo-secondary">Annuler</button>
            <button type="button" onclick="enregistrerSolde()" class="btn-neo">üíæ Enregistrer</button>
        </div>
    </div>
</div>

<!-- Modal : Historique des soldes -->
<div id="modal-historique-soldes" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #2D3436;">
            <h3 style="margin: 0; color: #2D3436;">üëÅÔ∏è Historique des soldes</h3>
            <button onclick="fermerModalHistoriqueSoldes()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
        </div>
        
        <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center;">
            <label>Filtrer par ann√©e :</label>
            <select id="modal-historique-annee" onchange="chargerHistoriqueSoldes()" style="padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
                <!-- G√©n√©r√© dynamiquement -->
            </select>
            <button type="button" onclick="chargerHistoriqueSoldes()" class="btn-neo-secondary">üîÑ Actualiser</button>
        </div>
        
        <div style="max-height: 500px; overflow-y: auto; border: 2px solid #e0e0e0; border-radius: 8px;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead style="position: sticky; top: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <tr>
                        <th style="padding: 12px; text-align: left;">Date</th>
                        <th style="padding: 12px; text-align: right;">Solde (‚Ç¨)</th>
                        <th style="padding: 12px; text-align: center; width: 80px;">Actions</th>
                    </tr>
                </thead>
                <tbody id="tbody-historique-soldes">
                    <!-- G√©n√©r√© dynamiquement -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- ==========================================
     MODALS - GESTION KILOM√àTRES
     ========================================== -->

<!-- Modal : Ajouter un trajet -->
<div id="modal-ajout-trajet" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #2D3436;">
            <h3 style="margin: 0; color: #2D3436;">‚ûï Ajouter un trajet</h3>
            <button onclick="fermerModalTrajet()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
        </div>
        
        <form id="form-ajout-trajet" onsubmit="soumettreTrajet(event)">
            <div class="fiscal-grid">
                <div class="form-group">
                    <label>Date du trajet *</label>
                    <input type="date" id="trajet-date" required>
                </div>
                
                <div class="form-group">
                    <label>Type de trajet *</label>
                    <select id="trajet-type" required onchange="updateMotifTrajet()">
                        <option value="menage_entree">M√©nage entr√©e</option>
                        <option value="menage_sortie">M√©nage sortie</option>
                        <option value="courses">Courses</option>
                        <option value="maintenance">Maintenance</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>
                
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label>Motif *</label>
                    <input type="text" id="trajet-motif" placeholder="Ex: M√©nage entr√©e - G√Æte La Roseraie" required>
                </div>
                
                <div class="form-group">
                    <label>D√©part</label>
                    <input type="text" id="trajet-depart" placeholder="Domicile (par d√©faut)" value="Domicile">
                </div>
                
                <div class="form-group">
                    <label>Destination *</label>
                    <select id="trajet-destination" required onchange="updateDistanceTrajet()">
                        <option value="">-- Choisir --</option>
                        <optgroup label="G√Ætes" id="optgroup-gites-trajet"></optgroup>
                        <optgroup label="Lieux favoris" id="optgroup-lieux-trajet"></optgroup>
                        <option value="autre">üñäÔ∏è Autre (saisir manuellement)</option>
                    </select>
                </div>
                
                <div class="form-group" id="trajet-destination-autre-group" style="display: none;">
                    <label>Nom destination</label>
                    <input type="text" id="trajet-destination-autre" placeholder="Ex: Leroy Merlin Cahors">
                </div>
                
                <div class="form-group">
                    <label>Distance aller (km) *</label>
                    <input type="number" id="trajet-distance" step="0.1" min="0" required>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="trajet-aller-retour" checked style="width: auto; margin-right: 5px;">
                        Aller-retour
                    </label>
                </div>
                
                <div class="form-group">
                    <label>Distance totale (calcul√©e)</label>
                    <input type="number" id="trajet-distance-totale" readonly style="background: #e8f5e9; font-weight: 600;">
                </div>
                
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label>Notes</label>
                    <textarea id="trajet-notes" rows="2" placeholder="Notes optionnelles..."></textarea>
                </div>
            </div>
            
            <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                <button type="button" onclick="fermerModalTrajet()" class="btn-neo-secondary">Annuler</button>
                <button type="submit" class="btn-neo">üíæ Enregistrer</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal : Configuration automatisation -->
<div id="modal-config-km" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #2D3436;">
            <h3 style="margin: 0; color: #2D3436;">‚öôÔ∏è Configuration automatisation</h3>
            <button onclick="fermerModalConfigKm()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
        </div>
        
        <form id="form-config-km" onsubmit="sauvegarderConfigKm(event)">
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <p style="margin: 0 0 15px 0; color: #666; font-size: 0.95rem;">
                    Cochez les types de trajets que vous souhaitez cr√©er automatiquement lors de l'ajout d'une r√©servation :
                </p>
                
                <div style="display: grid; gap: 12px;">
                    <label style="display: flex; align-items: center; padding: 10px; background: white; border-radius: 6px; cursor: pointer;">
                        <input type="checkbox" id="config-auto-menage-entree" style="width: auto; margin-right: 10px;">
                        <div>
                            <strong>M√©nage entr√©e</strong>
                            <div style="font-size: 0.85rem; color: #666;">Cr√©er un trajet la veille de l'arriv√©e client</div>
                        </div>
                    </label>
                    
                    <label style="display: flex; align-items: center; padding: 10px; background: white; border-radius: 6px; cursor: pointer;">
                        <input type="checkbox" id="config-auto-menage-sortie" style="width: auto; margin-right: 10px;">
                        <div>
                            <strong>M√©nage sortie</strong>
                            <div style="font-size: 0.85rem; color: #666;">Cr√©er un trajet le jour du d√©part client</div>
                        </div>
                    </label>
                    
                    <label style="display: flex; align-items: center; padding: 10px; background: white; border-radius: 6px; cursor: pointer;">
                        <input type="checkbox" id="config-auto-courses" style="width: auto; margin-right: 10px;">
                        <div>
                            <strong>Courses</strong>
                            <div style="font-size: 0.85rem; color: #666;">Cr√©er un trajet courses avant l'arriv√©e</div>
                        </div>
                    </label>
                    
                    <label style="display: flex; align-items: center; padding: 10px; background: white; border-radius: 6px; cursor: pointer;">
                        <input type="checkbox" id="config-auto-maintenance" style="width: auto; margin-right: 10px;">
                        <div>
                            <strong>Maintenance</strong>
                            <div style="font-size: 0.85rem; color: #666;">Cr√©er un trajet de maintenance p√©riodique</div>
                        </div>
                    </label>
                </div>
            </div>
            
            <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                <button type="button" onclick="fermerModalConfigKm()" class="btn-neo-secondary">Annuler</button>
                <button type="submit" class="btn-neo">üíæ Sauvegarder</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal : Gestion lieux favoris -->
<div id="modal-lieux-favoris" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #2D3436;">
            <h3 style="margin: 0; color: #2D3436;">üìç G√©rer mes lieux</h3>
            <button onclick="fermerModalLieuxFavoris()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
        </div>
        
        <!-- G√Ætes -->
        <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h4 style="margin-bottom: 15px; color: #6a1b9a;">üè† Mes g√Ætes</h4>
            <div id="liste-distances-gites" style="display: grid; gap: 10px;">
                <!-- G√©n√©r√© dynamiquement -->
            </div>
        </div>
        
        <!-- Magasins et autres lieux -->
        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h4 style="margin: 0; color: #1565c0;">üè™ Magasins & autres lieux</h4>
                <button type="button" onclick="afficherFormulaireNouveauLieu()" class="btn-neo-secondary">‚ûï Ajouter</button>
            </div>
            
            <div id="form-nouveau-lieu" style="display: none; background: white; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <div class="fiscal-grid">
                    <div class="form-group">
                        <label>Nom du lieu *</label>
                        <input type="text" id="nouveau-lieu-nom" placeholder="Ex: Intermarch√© Cahors">
                    </div>
                    <div class="form-group">
                        <label>Distance (km) *</label>
                        <input type="number" id="nouveau-lieu-distance" step="0.1" min="0">
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Adresse (optionnel)</label>
                        <input type="text" id="nouveau-lieu-adresse" placeholder="Adresse compl√®te">
                    </div>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px;">
                    <button type="button" onclick="annulerNouveauLieu()" class="btn-neo-secondary">Annuler</button>
                    <button type="button" onclick="enregistrerNouveauLieu()" class="btn-neo">üíæ Enregistrer</button>
                </div>
            </div>
            
            <div id="liste-lieux-favoris" style="display: grid; gap: 8px;">
                <!-- G√©n√©r√© dynamiquement -->
            </div>
        </div>
        
        <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
            <button type="button" onclick="fermerModalLieuxFavoris()" class="btn-neo">Fermer</button>
        </div>
    </div>
</div>
<!-- Modal : Configuration v√©hicule -->
<div id="modal-config-vehicule" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #2D3436;">
            <h3 style="margin: 0; color: #2D3436;">üöô Configuration de mon v√©hicule</h3>
            <button onclick="fermerModalConfigVehicule()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
        </div>
        
        <div style="background: #e3f2fd; padding: 20px; border-radius: 8px;">
            <div class="fiscal-grid" style="gap: 15px;">
                <div class="form-group">
                    <label>Type de v√©hicule *</label>
                    <select id="modal-vehicule-type" onchange="togglePuissanceFieldModal()">
                        <option value="thermique" selected>üõ¢Ô∏è Thermique (essence/diesel)</option>
                        <option value="electrique">‚ö° √âlectrique</option>
                    </select>
                </div>
                
                <div class="form-group" id="modal-puissance-group">
                    <label>Puissance fiscale (CV) *</label>
                    <select id="modal-puissance-fiscale">
                        <option value="3">3 CV</option>
                        <option value="4">4 CV</option>
                        <option value="5" selected>5 CV</option>
                        <option value="6">6 CV</option>
                        <option value="7">7 CV et +</option>
                    </select>
                </div>
            </div>
            
            <div style="background: rgba(255,255,255,0.6); padding: 15px; border-radius: 6px; margin-top: 15px;">
                <h4 style="margin: 0 0 10px 0; color: #1565c0; font-size: 0.95rem;">üìä Informations calcul√©es</h4>
                <div style="display: grid; gap: 8px; font-size: 0.9rem;">
                    <div style="display: flex; justify-content: space-between;">
                        <span>Total km professionnels :</span>
                        <strong id="modal-km-total">0 km</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Montant d√©ductible 2024 :</span>
                        <strong id="modal-montant-deductible" style="color: #27ae60;">0,00 ‚Ç¨</strong>
                    </div>
                </div>
            </div>
        </div>
        
        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
            <button type="button" onclick="fermerModalConfigVehicule()" class="btn-neo-secondary">Annuler</button>
            <button type="button" onclick="enregistrerConfigVehicule()" class="btn-neo">üíæ Enregistrer</button>
        </div>
    </div>
</div>

<!-- Modal Frais R√©els Imp√¥ts -->
<div id="modal-frais-reels" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;">
    <div class="modal-content" style="background: white; border-radius: 12px; padding: 0; max-width: 700px; width: 90%; max-height: 90vh; overflow: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
        <div style="background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%); color: white; padding: 25px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0; font-size: 1.4rem;">üöó D√©clarer mes frais r√©els professionnels</h3>
            <button onclick="closeFraisReelsModal()" style="background: transparent; border: none; color: white; font-size: 2rem; cursor: pointer;">√ó</button>
        </div>
        <div style="padding: 30px;">
            <p style="color: #666; margin-bottom: 20px; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 6px;">‚ö†Ô∏è Ces frais concernent vos d√©placements personnels (domicile-travail).</p>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div><label>Kilom√®tres parcourus (an)</label><input type="number" id="km_perso_impots_modal" step="1" placeholder="0" oninput="calculerFraisReelsImpots()" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px;"></div>
                <div><label>Chevaux fiscaux</label><input type="number" id="chevaux_fiscaux_impots_modal" step="1" value="5" oninput="calculerFraisReelsImpots()" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px;"></div>
                <div><label>P√©ages annuels (‚Ç¨)</label><input type="number" id="peages_impots_modal" step="0.01" placeholder="0.00" oninput="calculerFraisReelsImpots()" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px;"></div>
            </div>
            <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: white; border-radius: 8px; text-align: center;">
                <div style="font-size: 0.95rem;">üí∞ D√©duction frais r√©els totale</div>
                <div id="total-frais-reels-impots-modal" style="font-size: 2rem; font-weight: 700;">0.00 ‚Ç¨</div>
            </div>
        </div>
        <div style="padding: 20px 30px; background: #f5f5f5; border-radius: 0 0 12px 12px; display: flex; gap: 15px; justify-content: flex-end;">
            <button onclick="closeFraisReelsModal()" style="padding: 12px 24px; background: #9e9e9e; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">Annuler</button>
            <button onclick="validerFraisReels()" style="padding: 12px 24px; background: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">‚úì Valider</button>
        </div>
    </div>
</div>
