<!-- TAB FICHES CLIENTS - Gestion et g√©n√©ration des fiches clients personnalis√©es -->
<div class="container" id="fichesClientContent" style="display: none;">
    <h2 style="margin-bottom: 30px; color: var(--primary); font-family: 'Playfair Display', serif;">
        üìÑ Fiches Clients Interactives
    </h2>
    
    <!-- Statistiques rapides -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="stats-card">
            <div class="stats-icon">üìä</div>
            <div class="stats-value" id="statsNbFiches">0</div>
            <div class="stats-label">Fiches g√©n√©r√©es</div>
        </div>
        <div class="stats-card">
            <div class="stats-icon">üëÅÔ∏è</div>
            <div class="stats-value" id="statsNbOuvertures">0</div>
            <div class="stats-label">Ouvertures totales</div>
        </div>
        <div class="stats-card">
            <div class="stats-icon">‚è∞</div>
            <div class="stats-value" id="statsNbDemandesHoraires">0</div>
            <div class="stats-label">Demandes horaires</div>
        </div>
        <div class="stats-card">
            <div class="stats-icon">üí¨</div>
            <div class="stats-value" id="statsNbRetours">0</div>
            <div class="stats-label">Retours clients</div>
        </div>
    </div>
    
    <!-- Filtres -->
    <div class="filters-section" style="margin-bottom: 30px;">
        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
            <select id="filterGiteFiches" class="input" style="max-width: 200px;">
                <option value="tous">Tous les g√Ætes</option>
                <option value="Trevoux">Trevoux</option>
                <option value="Couzon">Couzon</option>
            </select>
            
            <select id="filterStatutFiche" class="input" style="max-width: 200px;">
                <option value="tous">Tous les statuts</option>
                <option value="generee">Fiche g√©n√©r√©e</option>
                <option value="non_generee">Non g√©n√©r√©e</option>
                <option value="expiree">Expir√©e</option>
            </select>
            
            <input type="date" id="filterDateDebutFiches" class="input" style="max-width: 180px;" 
                   placeholder="Date d√©but">
            
            <input type="search" id="searchClientFiches" class="input" style="flex: 1; max-width: 300px;" 
                   placeholder="Rechercher un client...">
            
            <button class="btn btn-primary" onclick="loadFichesClientList()">
                üîÑ Actualiser
            </button>
        </div>
    </div>
    
    <!-- Navigation Sous-onglets -->
    <div class="sub-tabs" style="margin-bottom: 20px;">
        <button class="sub-tab-btn active" data-subtab="liste-fiches">
            üìã Liste des r√©servations
        </button>
        <button class="sub-tab-btn" data-subtab="demandes-horaires">
            ‚è∞ Demandes horaires
            <span class="badge" id="badgeDemandesEnAttente">0</span>
        </button>
        <button class="sub-tab-btn" data-subtab="retours-clients">
            üí¨ Retours clients
            <span class="badge" id="badgeRetoursNonTraites">0</span>
        </button>
        <button class="sub-tab-btn" data-subtab="config-gites">
            ‚öôÔ∏è Configuration g√Ætes
        </button>
        <button class="sub-tab-btn" data-subtab="config-checklists">
            ‚úÖ Checklists
        </button>
    </div>
    
    <!-- Sous-onglet: Liste des r√©servations -->
    <div class="sub-tab-content active" id="subtab-liste-fiches">
        <div id="listeFichesContainer" class="fiches-list"></div>
    </div>
    
    <!-- Sous-onglet: Demandes horaires -->
    <div class="sub-tab-content" id="subtab-demandes-horaires">
        <div id="demandesHorairesContainer"></div>
    </div>
    
    <!-- Sous-onglet: Retours clients -->
    <div class="sub-tab-content" id="subtab-retours-clients">
        <div id="retoursClientsContainer"></div>
    </div>
    
    <!-- Sous-onglet: Configuration g√Ætes -->
    <div class="sub-tab-content" id="subtab-config-gites">
        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
            <button class="btn btn-secondary" onclick="editGiteInfo('Trevoux')">
                üè° Configurer Trevoux
            </button>
            <button class="btn btn-secondary" onclick="editGiteInfo('Couzon')">
                üè° Configurer Couzon
            </button>
        </div>
        <div id="giteConfigContainer"></div>
    </div>
    
    <!-- Sous-onglet: Configuration checklists -->
    <div class="sub-tab-content" id="subtab-config-checklists">
        <div style="margin-bottom: 20px;">
            <label style="font-weight: 600; margin-bottom: 10px; display: block;">G√Æte :</label>
            <select id="selectGiteChecklist" class="input" style="max-width: 200px;" onchange="loadChecklistsConfig()">
                <option value="Trevoux">Trevoux</option>
                <option value="Couzon">Couzon</option>
            </select>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h3 style="margin-bottom: 15px;">‚úÖ Checklist Entr√©e</h3>
                <button class="btn btn-success" onclick="addChecklistItem('entree')" style="margin-bottom: 10px;">
                    ‚ûï Ajouter un item
                </button>
                <div id="checklistEntreeConfig"></div>
            </div>
            <div>
                <h3 style="margin-bottom: 15px;">‚úÖ Checklist Sortie</h3>
                <button class="btn btn-success" onclick="addChecklistItem('sortie')" style="margin-bottom: 10px;">
                    ‚ûï Ajouter un item
                </button>
                <div id="checklistSortieConfig"></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: G√©n√©ration de fiche -->
<div id="modalGenereFiche" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <span class="close" onclick="closeModal('modalGenereFiche')">&times;</span>
        <h2>üìÑ G√©n√©rer la fiche client</h2>
        
        <div id="ficheGenereeInfo" style="display: none; margin-top: 20px;">
            <div class="success-message" style="background: #d1fae5; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                ‚úÖ Fiche g√©n√©r√©e avec succ√®s !
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">URL de la fiche :</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="ficheUrlGenerated" class="input" readonly style="flex: 1;">
                    <button class="btn btn-secondary" onclick="copyFicheUrl()">üìã Copier</button>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-success" onclick="openFicheClient()">
                    üëÅÔ∏è Voir la fiche
                </button>
                <button class="btn btn-primary" onclick="sendWhatsAppFiche()">
                    üí¨ Envoyer par WhatsApp
                </button>
            </div>
        </div>
        
        <div id="ficheGenerationForm">
            <p style="margin-bottom: 20px;">
                G√©n√©rer une fiche personnalis√©e pour la r√©servation de <strong id="clientNameFiche"></strong>.
            </p>
            
            <div class="info-box" style="background: #fef3c7; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                ‚ÑπÔ∏è La fiche sera accessible pendant 7 jours apr√®s la date de d√©part.
            </div>
            
            <button class="btn btn-primary btn-full" onclick="confirmerGenerationFiche()">
                üìÑ G√©n√©rer la fiche
            </button>
        </div>
    </div>
</div>

<!-- Modal: √âdition Info G√Æte -->
<div id="modalEditGite" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
        <span class="close" onclick="closeModal('modalEditGite')">&times;</span>
        <h2>‚öôÔ∏è Configuration du g√Æte <span id="giteNameEdit"></span></h2>
        
        <form id="formEditGite" onsubmit="return saveGiteInfo(event)">
            <input type="hidden" id="editGiteId">
            
            <!-- Acc√®s -->
            <h3 style="margin-top: 20px; margin-bottom: 15px;">üîë Acc√®s</h3>
            
            <div class="form-group">
                <label class="label">Code d'entr√©e *</label>
                <input type="text" id="editCodeEntree" class="input" required>
            </div>
            
            <div class="form-group">
                <label class="label">Adresse compl√®te *</label>
                <input type="text" id="editAdresse" class="input" required>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label class="label">Latitude</label>
                    <input type="number" step="0.000001" id="editLatitude" class="input">
                </div>
                <div class="form-group">
                    <label class="label">Longitude</label>
                    <input type="number" step="0.000001" id="editLongitude" class="input">
                </div>
            </div>
            
            <div class="form-group">
                <label class="label">Instructions d'acc√®s (Fran√ßais) *</label>
                <textarea id="editInstructionsFr" class="textarea" rows="4" required></textarea>
            </div>
            
            <div class="form-group">
                <label class="label">Instructions d'acc√®s (Anglais) *</label>
                <textarea id="editInstructionsEn" class="textarea" rows="4" required></textarea>
            </div>
            
            <!-- WiFi -->
            <h3 style="margin-top: 20px; margin-bottom: 15px;">üì∂ WiFi</h3>
            
            <div class="form-group">
                <label class="label">SSID (Nom du r√©seau) *</label>
                <input type="text" id="editWifiSsid" class="input" required>
            </div>
            
            <div class="form-group">
                <label class="label">Mot de passe WiFi *</label>
                <input type="text" id="editWifiPassword" class="input" required>
            </div>
            
            <div class="form-group">
                <label class="label">URL du QR Code WiFi</label>
                <input type="url" id="editWifiQr" class="input" placeholder="https://...">
                <small style="color: var(--gray-600);">G√©n√©rer un QR Code WiFi sur qifi.org ou wifi-qr.com</small>
            </div>
            
            <!-- Horaires -->
            <h3 style="margin-top: 20px; margin-bottom: 15px;">‚è∞ Horaires</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label class="label">Heure arriv√©e standard</label>
                    <input type="time" id="editHeureArrivee" class="input">
                </div>
                <div class="form-group">
                    <label class="label">Heure d√©part standard</label>
                    <input type="time" id="editHeureDepart" class="input">
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label class="label">Arriv√©e anticip√©e min (sans m√©nage)</label>
                    <input type="time" id="editHeureArriveeMin" class="input">
                </div>
                <div class="form-group">
                    <label class="label">Arriv√©e si m√©nage apr√®s-midi</label>
                    <input type="time" id="editHeureArriveeAvecMenage" class="input">
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label class="label">D√©part tardif max semaine</label>
                    <input type="time" id="editHeureDepartMax" class="input">
                </div>
                <div class="form-group">
                    <label class="label">D√©part dimanche max</label>
                    <input type="time" id="editHeureDepartDimanche" class="input">
                </div>
            </div>
            
            <!-- R√®glement -->
            <h3 style="margin-top: 20px; margin-bottom: 15px;">üìã R√®glement & Consignes</h3>
            
            <div class="form-group">
                <label class="label">R√®glement int√©rieur (Fran√ßais)</label>
                <textarea id="editReglementFr" class="textarea" rows="5"></textarea>
            </div>
            
            <div class="form-group">
                <label class="label">R√®glement int√©rieur (Anglais)</label>
                <textarea id="editReglementEn" class="textarea" rows="5"></textarea>
            </div>
            
            <div style="text-align: right; margin-top: 20px;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('modalEditGite')" style="margin-right: 10px;">
                    Annuler
                </button>
                <button type="submit" class="btn btn-primary">
                    üíæ Enregistrer
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal: Approuver/Refuser demande horaire -->
<div id="modalDemandeHoraire" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <span class="close" onclick="closeModal('modalDemandeHoraire')">&times;</span>
        <h2 id="titreDemande"></h2>
        
        <div id="detailsDemande" style="margin: 20px 0;"></div>
        
        <div id="actionsDemande">
            <button class="btn btn-success" onclick="approuverDemande()" style="margin-right: 10px;">
                ‚úÖ Approuver
            </button>
            <button class="btn btn-danger" onclick="showRefusForm()">
                ‚ùå Refuser
            </button>
        </div>
        
        <div id="formRefus" style="display: none; margin-top: 20px;">
            <div class="form-group">
                <label class="label">Raison du refus *</label>
                <textarea id="raisonRefus" class="textarea" rows="3" required></textarea>
            </div>
            <button class="btn btn-danger" onclick="refuserDemande()">
                ‚ùå Confirmer le refus
            </button>
        </div>
    </div>
</div>

<style>
    /* Styles pour les fiches clients */
    .fiches-list {
        display: grid;
        gap: 20px;
    }
    
    .fiche-card {
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        padding: 20px;
        transition: box-shadow 0.2s;
    }
    
    .fiche-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .fiche-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 15px;
    }
    
    .fiche-info h3 {
        margin: 0;
        color: var(--text-dark);
        font-size: 1.25rem;
    }
    
    .fiche-dates {
        color: var(--gray-600);
        font-size: 0.875rem;
        margin-top: 5px;
    }
    
    .fiche-status {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 600;
    }
    
    .status-generee {
        background: #d1fae5;
        color: #065f46;
    }
    
    .status-non-generee {
        background: #fee2e2;
        color: #991b1b;
    }
    
    .status-expiree {
        background: #f3f4f6;
        color: #6b7280;
    }
    
    .fiche-indicators {
        display: flex;
        gap: 15px;
        margin: 15px 0;
        flex-wrap: wrap;
    }
    
    .indicator {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.875rem;
        color: var(--gray-600);
    }
    
    .indicator-badge {
        background: var(--primary);
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .fiche-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .sub-tabs {
        display: flex;
        gap: 10px;
        border-bottom: 2px solid var(--gray-200);
        flex-wrap: wrap;
    }
    
    .sub-tab-btn {
        padding: 12px 20px;
        border: none;
        background: transparent;
        border-bottom: 2px solid transparent;
        cursor: pointer;
        font-weight: 600;
        color: var(--gray-600);
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .sub-tab-btn:hover {
        color: var(--primary);
    }
    
    .sub-tab-btn.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
    }
    
    .sub-tab-content {
        display: none;
    }
    
    .sub-tab-content.active {
        display: block;
    }
    
    .badge {
        background: var(--danger);
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 700;
    }
    
    .demande-card {
        background: white;
        border: 2px solid var(--warning);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
    }
    
    .demande-card.approved {
        border-color: var(--success);
    }
    
    .demande-card.refused {
        border-color: var(--danger);
    }
    
    .retour-card {
        background: white;
        border-left: 4px solid var(--primary);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 15px;
    }
    
    .retour-card.probleme {
        border-left-color: var(--danger);
    }
    
    .retour-card.amelioration {
        border-left-color: #8b5cf6;
    }
    
    .checklist-item-config {
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .draggable {
        cursor: move;
    }
</style>
