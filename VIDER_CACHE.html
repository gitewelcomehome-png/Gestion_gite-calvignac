<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Vider Cache et Recharger</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 100px auto;
            padding: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }
        h1 { font-size: 2.5em; margin-bottom: 20px; }
        .button {
            background: white;
            color: #667eea;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }
        .button:hover {
            transform: scale(1.05);
        }
        .info {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .success {
            background: #10b981;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
    </style>
</head>
<body>
    <h1>üîÑ Vider Cache & Recharger</h1>
    
    <div class="info">
        <p>Ce script va :</p>
        <ul style="text-align: left; list-style-position: inside;">
            <li>Vider TOUS les caches (LocalStorage, SessionStorage, Cache API)</li>
            <li>Forcer le rechargement de tous les fichiers JS</li>
            <li>Red√©marrer l'application proprement</li>
        </ul>
    </div>
    
    <button class="button" onclick="viderTout()">üóëÔ∏è Vider et Recharger</button>
    
    <div class="success" id="success">
        ‚úÖ Cache vid√© ! Rechargement...
    </div>
    
    <script>
        async function viderTout() {
            console.log('üóëÔ∏è Vidage du cache...');
            
            // 1. Vider LocalStorage
            localStorage.clear();
            console.log('‚úÖ LocalStorage vid√©');
            
            // 2. Vider SessionStorage
            sessionStorage.clear();
            console.log('‚úÖ SessionStorage vid√©');
            
            // 3. Vider Cache API
            if ('caches' in window) {
                const cacheNames = await caches.keys();
                await Promise.all(cacheNames.map(name => caches.delete(name)));
                console.log('‚úÖ Cache API vid√©');
            }
            
            // 4. D√©senregistrer service workers
            if ('serviceWorker' in navigator) {
                const registrations = await navigator.serviceWorker.getRegistrations();
                for (const registration of registrations) {
                    await registration.unregister();
                }
                console.log('‚úÖ Service Workers supprim√©s');
            }
            
            // 5. Afficher confirmation
            document.getElementById('success').style.display = 'block';
            
            // 6. Recharger avec cache vid√© (Ctrl+Shift+R)
            setTimeout(() => {
                window.location.href = '/workspaces/Gestion_gite-calvignac/index.html?nocache=' + Date.now();
                // Force hard reload
                location.reload(true);
            }, 1000);
        }
    </script>
</body>
</html>
