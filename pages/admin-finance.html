<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance & BI - Channel Manager</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/admin-dashboard.css">
    <link rel="stylesheet" href="../css/admin-finance.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body style="background: #F9FAFB;">
    <div class="admin-wrapper">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-left">
                <button class="btn-back" onclick="window.location.href='admin-channel-manager.html'">
                    <i data-lucide="arrow-left"></i>
                    Retour Dashboard
                </button>
                <h1>
                    <i data-lucide="trending-up"></i>
                    Finance & Business Intelligence
                </h1>
            </div>
            <div class="header-right">
                <select id="periodSelector" class="form-select">
                    <option value="30">30 derniers jours</option>
                    <option value="90" selected>90 derniers jours</option>
                    <option value="365">12 derniers mois</option>
                    <option value="all">Depuis le début</option>
                </select>
            </div>
        </header>

        <!-- Main Container -->
        <main class="admin-container">
            
            <!-- Métriques Financières Principales -->
            <section class="kpis-grid">
                <div class="kpi-card">
                    <div class="kpi-icon" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); box-shadow: 0 8px 16px rgba(16, 185, 129, 0.25);">
                        <i data-lucide="dollar-sign" style="color: white; width: 36px; height: 36px;"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-label">Revenus Totaux</div>
                        <div class="kpi-value" id="kpiRevenuTotal">0 €</div>
                        <div class="kpi-change positive" id="kpiRevenuChange">
                            <i data-lucide="arrow-up"></i> <span>+0%</span>
                        </div>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-icon" style="background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); box-shadow: 0 8px 16px rgba(59, 130, 246, 0.25);">
                        <i data-lucide="wallet" style="color: white; width: 36px; height: 36px;"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-label">MRR (Monthly Recurring)</div>
                        <div class="kpi-value" id="kpiMRR">0 €</div>
                        <div class="kpi-change positive" id="kpiMRRChange">
                            <i data-lucide="arrow-up"></i> <span>+0%</span>
                        </div>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-icon" style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); box-shadow: 0 8px 16px rgba(245, 158, 11, 0.25);">
                        <i data-lucide="percent" style="color: white; width: 36px; height: 36px;"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-label">Marge Brute</div>
                        <div class="kpi-value" id="kpiMarge">0%</div>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-icon" style="background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%); box-shadow: 0 8px 16px rgba(156, 39, 176, 0.25);">
                        <i data-lucide="activity" style="color: white; width: 36px; height: 36px;"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-label">Taux de Croissance</div>
                        <div class="kpi-value" id="kpiCroissance">+0%</div>
                    </div>
                </div>
            </section>

            <!-- Métriques SaaS Avancées -->
            <section class="kpis-grid">
                <div class="kpi-card">
                    <div class="kpi-icon" style="background: linear-gradient(135deg, #EC4899 0%, #DB2777 100%); box-shadow: 0 8px 16px rgba(236, 72, 153, 0.25);">
                        <i data-lucide="user-check" style="color: white; width: 36px; height: 36px;"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-label">LTV (Lifetime Value)</div>
                        <div class="kpi-value" id="kpiLTV">0 €</div>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-icon" style="background: linear-gradient(135deg, #06B6D4 0%, #0891B2 100%); box-shadow: 0 8px 16px rgba(6, 182, 212, 0.25);">
                        <i data-lucide="megaphone" style="color: white; width: 36px; height: 36px;"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-label">CAC (Coût Acquisition)</div>
                        <div class="kpi-value" id="kpiCAC">0 €</div>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-icon" style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); box-shadow: 0 8px 16px rgba(139, 92, 246, 0.25);">
                        <i data-lucide="calendar-clock" style="color: white; width: 36px; height: 36px;"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-label">Payback Period</div>
                        <div class="kpi-value" id="kpiPayback">0 mois</div>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-icon" style="background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%); box-shadow: 0 8px 16px rgba(239, 68, 68, 0.25);">
                        <i data-lucide="trending-down" style="color: white; width: 36px; height: 36px;"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-label">Taux de Churn</div>
                        <div class="kpi-value" id="kpiChurnRate">0%</div>
                    </div>
                </div>
            </section>

            <!-- Graphiques -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <!-- Graphique Revenus -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>
                            <i data-lucide="bar-chart-2"></i>
                            Évolution des Revenus
                        </h3>
                    </div>
                    <div class="chart-body">
                        <canvas id="revenusChart"></canvas>
                    </div>
                </div>

                <!-- Graphique Répartition -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>
                            <i data-lucide="pie-chart"></i>
                            Répartition par Abonnement
                        </h3>
                    </div>
                    <div class="chart-body">
                        <canvas id="repartitionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Cohort Analysis -->
            <section class="data-table-section">
                <div class="section-header">
                    <h2>
                        <i data-lucide="users"></i>
                        Analyse par Cohorte (Rétention)
                    </h2>
                </div>
                <div class="table-container">
                    <table class="data-table cohort-table" id="tableCohorts">
                        <thead>
                            <tr>
                                <th>Cohorte</th>
                                <th>Clients</th>
                                <th>Mois 0</th>
                                <th>Mois 1</th>
                                <th>Mois 2</th>
                                <th>Mois 3</th>
                                <th>Mois 6</th>
                                <th>Mois 12</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyCohorts">
                            <tr>
                                <td colspan="8" class="loading-row">
                                    <div class="loading">Chargement...</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Transactions Récentes -->
            <section class="data-table-section">
                <div class="section-header">
                    <h2>
                        <i data-lucide="credit-card"></i>
                        Transactions Récentes
                    </h2>
                    <button class="btn-primary" onclick="exportTransactions()">
                        <i data-lucide="download"></i>
                        Exporter CSV
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="tableTransactions">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Client</th>
                                <th>Type</th>
                                <th>Abonnement</th>
                                <th>Montant</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyTransactions">
                            <tr>
                                <td colspan="6" class="loading-row">
                                    <div class="loading">Chargement...</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Prédictions IA -->
            <section class="predictions-section">
                <div class="section-header">
                    <h2>
                        <i data-lucide="sparkles"></i>
                        Prédictions IA
                    </h2>
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
                    <div class="prediction-card">
                        <div class="prediction-icon">
                            <i data-lucide="trending-up"></i>
                        </div>
                        <div class="prediction-content">
                            <div class="prediction-label">Revenus prévus (30j)</div>
                            <div class="prediction-value" id="predRevenu">0 €</div>
                            <div class="prediction-confidence">Confiance: <span id="predRevenuConf">0%</span></div>
                        </div>
                    </div>
                    <div class="prediction-card">
                        <div class="prediction-icon">
                            <i data-lucide="users"></i>
                        </div>
                        <div class="prediction-content">
                            <div class="prediction-label">Nouveaux clients (30j)</div>
                            <div class="prediction-value" id="predClients">0</div>
                            <div class="prediction-confidence">Confiance: <span id="predClientsConf">0%</span></div>
                        </div>
                    </div>
                    <div class="prediction-card">
                        <div class="prediction-icon">
                            <i data-lucide="alert-triangle"></i>
                        </div>
                        <div class="prediction-content">
                            <div class="prediction-label">Risque de churn (30j)</div>
                            <div class="prediction-value" id="predChurn">0</div>
                            <div class="prediction-confidence">Confiance: <span id="predChurnConf">0%</span></div>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/shared-config.js"></script>
    <script src="../js/admin-finance.js"></script>
    <script>
        // Initialiser Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>
