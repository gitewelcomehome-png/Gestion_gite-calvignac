<div class="tab-container calou-wrapper">
    <!-- üê∫ Dashboard CALOU v1.0 - Migration progressive -->
    
    <!-- En-t√™te avec semaine actuelle -->
    <div class="calou-card calou-p-6 calou-mb-6">
        <div class="calou-flex calou-justify-between calou-items-center calou-flex-wrap calou-gap-4">
            <div>
                <h2 class="calou-text-xl calou-font-extrabold calou-m-0 calou-uppercase">
                    <i data-calou-icon="dashboard" data-size="lg" class="calou-icon-spaced"></i>
                    Tableau de Bord
                </h2>
                <p id="dashboard-week-info" class="calou-text-sm calou-opacity-60 calou-mt-2 calou-m-0">Semaine en cours</p>
            </div>
            <div class="calou-flex calou-items-center calou-gap-4">
                <button onclick="updateFinancialIndicators()" class="calou-btn-primary">
                    <i data-calou-icon="sync" data-size="sm"></i>
                    Actualiser
                </button>
                <div class="calou-text-right">
                    <div id="dashboard-date" class="calou-text-base calou-font-bold">29 d√©cembre 2025</div>
                    <div id="dashboard-week-number" class="calou-text-xs calou-opacity-60 calou-mt-1">Semaine 52</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ö†Ô∏è DEMANDES CLIENTS URGENTES -->
    <div id="dashboard-demandes-clients" class="calou-card calou-alert calou-alert-warning calou-mb-6" style="display: none;">
        <div class="calou-flex calou-items-center calou-justify-between calou-mb-4">
            <h2 class="calou-text-lg calou-font-bold calou-m-0 calou-uppercase">
                <i data-calou-icon="doc" data-size="md" class="calou-icon-spaced"></i>
                Fiches Clients √† Envoyer
            </h2>
            <span id="badge-demandes-count" class="calou-badge">0</span>
        </div>
        <div id="liste-demandes-clients" class="calou-flex calou-flex-col calou-gap-3">
            <p class="calou-opacity-60 calou-m-0" style="font-style: italic;">Aucune demande en attente</p>
        </div>
    </div>

    <!-- ‚ö†Ô∏è PROBL√àMES URGENTS -->
    <div id="dashboard-problemes-urgents" class="calou-card calou-alert calou-alert-error calou-mb-6" style="display: none;">
        <div class="calou-flex calou-items-center calou-justify-between calou-mb-4">
            <h2 class="calou-text-lg calou-font-bold calou-m-0 calou-uppercase">
                <i data-calou-icon="alert" data-size="md" class="calou-icon-spaced calou-icon-pulse"></i>
                Probl√®mes Urgents
            </h2>
            <span id="badge-problemes-urgents-count" class="calou-badge calou-badge-error">0</span>
        </div>
        <div id="liste-problemes-urgents" class="calou-flex calou-flex-col calou-gap-3">
            <p class="calou-opacity-60 calou-m-0" style="font-style: italic;">Aucun probl√®me urgent</p>
        </div>
    </div>

    <!-- üí¨ DEMANDES & RETOURS CLIENTS -->
    <div id="dashboard-demandes-retours" class="calou-card calou-card-info calou-mb-6" style="display: none;">
        <div class="calou-flex calou-items-center calou-justify-between calou-mb-4">
            <h2 class="calou-text-lg calou-font-bold calou-m-0 calou-uppercase">
                <i data-calou-icon="user" data-size="md" class="calou-icon-spaced"></i>
                Demandes & Retours
            </h2>
            <span id="badge-demandes-retours-count" class="calou-badge calou-badge-primary">0</span>
        </div>
        <div id="liste-demandes-retours" class="calou-flex calou-flex-col calou-gap-3">
            <p class="calou-opacity-60 calou-m-0" style="font-style: italic;">Aucune demande en attente</p>
        </div>
    </div>

    <!-- Alertes / Notifications -->
    <div id="dashboard-alerts" class="calou-mb-6"></div>

    <!-- ========================================
         üìä VISION GLOBALE
         ======================================== -->
    <div class="calou-card calou-p-8 calou-mb-8">
        <h2 class="calou-section-title calou-mb-6 calou-pb-4" style="border-bottom: 2px solid var(--calou-border);">
            <i data-calou-icon="dashboard" data-size="lg" class="calou-icon-spaced"></i>
            Vision Globale
        </h2>
        
        <!-- Indicateurs fiscaux - Ligne 1 -->
        <div class="calou-grid calou-grid-cols-1 calou-md-grid-cols-2 calou-gap-6 calou-mb-6">
            <!-- URSSAF -->
            <div class="calou-card calou-card-info calou-p-6">
                <div class="calou-text-base calou-font-bold calou-mb-4 calou-text-center calou-uppercase calou-text-accent">
                    <i data-calou-icon="euro" data-size="sm" class="calou-icon-spaced"></i>
                    URSSAF
                </div>
                <div class="calou-grid calou-grid-cols-2 calou-gap-4">
                    <!-- 2025 -->
                    <div class="calou-card calou-kpi calou-text-center">
                        <p class="calou-kpi-label">2025</p>
                        <h3 id="dashboard-urssaf-2025" class="calou-kpi-value calou-text-accent">-</h3>
                        <p class="calou-kpi-meta">Ann√©e pr√©c√©dente</p>
                    </div>
                    <!-- 2026 -->
                    <div class="calou-card calou-kpi calou-card-success calou-text-center">
                        <p class="calou-kpi-label">2026</p>
                        <h3 id="dashboard-urssaf-2026" class="calou-kpi-value calou-text-accent">-</h3>
                        <p class="calou-kpi-meta">En cours</p>
                    </div>
                </div>
            </div>

            <!-- IR -->
            <div id="dashboard-ir-container" class="calou-card calou-card-error calou-p-6">
                <div class="calou-text-base calou-font-bold calou-mb-4 calou-text-center calou-uppercase calou-text-error">
                    <i data-calou-icon="doc" data-size="sm" class="calou-icon-spaced"></i>
                    Imp√¥t sur le Revenu
                </div>
                <div class="calou-grid calou-grid-cols-2 calou-gap-4">
                    <!-- 2025 -->
                    <div class="calou-card calou-kpi calou-text-center">
                        <p class="calou-kpi-label">2025</p>
                        <h3 id="dashboard-ir-2025" class="calou-kpi-value calou-text-error">-</h3>
                        <p class="calou-kpi-meta">Ann√©e pr√©c√©dente</p>
                    </div>
                    <!-- 2026 -->
                    <div class="calou-card calou-kpi calou-text-center">
                        <p class="calou-kpi-label">2026</p>
                        <h3 id="dashboard-ir-2026" class="calou-kpi-value calou-text-error">-</h3>
                        <p class="calou-kpi-meta">Estimation</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Indicateurs financiers - Ligne 2 -->
        <div class="calou-grid calou-grid-cols-1 calou-md-grid-cols-2 calou-gap-6 calou-mb-6">
            <!-- Chiffre d'Affaires -->
            <div class="calou-card calou-card-info calou-p-6">
                <div class="calou-text-base calou-font-bold calou-mb-4 calou-text-center calou-uppercase calou-text-accent">
                    <i data-calou-icon="euro" data-size="sm" class="calou-icon-spaced"></i>
                    Chiffre d'Affaires
                </div>
                <div class="calou-grid calou-grid-cols-2 calou-gap-4">
                    <div class="calou-card calou-kpi calou-text-center">
                        <p class="calou-kpi-label">Mois en cours</p>
                        <h3 id="dashboard-ca-mois" class="calou-kpi-value calou-text-accent">-</h3>
                    </div>
                    <div class="calou-card calou-kpi calou-text-center">
                        <p class="calou-kpi-label">Ann√©e <span id="annee-ca">2026</span></p>
                        <h3 id="dashboard-ca-annee" class="calou-kpi-value calou-text-accent">-</h3>
                    </div>
                </div>
            </div>

            <!-- B√©n√©fices & Tr√©sorerie -->
            <div class="calou-card calou-card-success calou-p-6">
                <div class="calou-text-base calou-font-bold calou-mb-4 calou-text-center calou-uppercase calou-text-success">
                    <i data-calou-icon="euro" data-size="sm" class="calou-icon-spaced"></i>
                    B√©n√©fices & Tr√©sorerie
                </div>
                <div class="calou-grid calou-grid-cols-2 calou-gap-4">
                    <div class="calou-card calou-kpi calou-text-center">
                        <p class="calou-kpi-label">B√©n√©fice <span id="annee-benefice">2026</span></p>
                        <h3 id="dashboard-benefice-moyen" class="calou-kpi-value calou-text-success">-</h3>
                        <p class="calou-kpi-meta">CA - Charges</p>
                    </div>
                    <div class="calou-card calou-kpi calou-text-center">
                        <p class="calou-kpi-label">Tr√©sorerie Actuelle</p>
                        <h3 id="dashboard-tresorerie" class="calou-kpi-value calou-text-success">-</h3>
                        <p class="calou-kpi-meta">Solde bancaire</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Graphiques financiers -->
        <div class="calou-grid calou-grid-cols-1 calou-md-grid-cols-2 calou-gap-6">
            <!-- B√©n√©fices mensuels -->
            <div class="calou-card calou-p-6">
                <div class="calou-flex calou-items-center calou-gap-2 calou-mb-4 calou-pb-3" style="border-bottom: 2px solid var(--calou-accent);">
                    <i data-calou-icon="euro" data-size="md" data-color="primary"></i>
                    <h3 class="calou-text-base calou-font-bold calou-m-0 calou-text-accent calou-uppercase">B√©n√©fices Mensuels</h3>
                </div>
                <div style="padding: 10px 0;">
                    <canvas id="graphique-benefices-gites" style="max-height: 300px;"></canvas>
                </div>
            </div>

            <!-- Tr√©sorerie -->
            <div class="calou-card calou-p-6">
                <div class="calou-flex calou-items-center calou-gap-2 calou-mb-4 calou-pb-3" style="border-bottom: 2px solid var(--calou-success);">
                    <i data-calou-icon="euro" data-size="md" data-color="success"></i>
                    <h3 class="calou-text-base calou-font-bold calou-m-0 calou-text-success calou-uppercase">√âvolution Tr√©sorerie</h3>
                </div>
                <div style="padding: 10px 0;">
                    <canvas id="graphique-tresorerie-dashboard" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================
         üéØ VISION ACTION
         ======================================== -->
    <div class="calou-card calou-p-8 calou-mb-8">
        <h2 class="calou-section-title calou-mb-6 calou-pb-4" style="border-bottom: 2px solid var(--calou-border);">
            <i data-calou-icon="check" data-size="lg" class="calou-icon-spaced"></i>
            Vision Actions
        </h2>
        
        <!-- Layout 2 colonnes -->
        <div class="calou-grid calou-grid-cols-1 calou-md-grid-cols-2 calou-gap-8">
        
            <!-- COLONNE GAUCHE : R√©servations + M√©nages -->
            <div class="calou-flex calou-flex-col calou-gap-6">
                <!-- R√©servations √† venir -->
                <div class="calou-card calou-p-6" style="border-left: 4px solid var(--calou-accent); min-height: 200px;">
                    <div class="calou-flex calou-items-center calou-gap-2 calou-mb-4">
                        <i data-calou-icon="calendar" data-size="lg" data-color="primary"></i>
                        <h3 class="calou-text-base calou-font-bold calou-m-0 calou-text-accent">R√©servations √† Venir</h3>
                    </div>
                    <div id="dashboard-reservations" class="calou-text-sm">
                        <p class="calou-opacity-60">Chargement...</p>
                    </div>
                </div>

                <!-- M√©nages √† faire -->
                <div class="calou-card calou-p-6" style="border-left: 4px solid var(--calou-warning); min-height: 200px;">
                    <div class="calou-flex calou-items-center calou-gap-2 calou-mb-4">
                        <i data-calou-icon="broom" data-size="lg" data-color="warning"></i>
                        <h3 class="calou-text-base calou-font-bold calou-m-0 calou-text-warning">M√©nages √† Faire</h3>
                    </div>
                    <div id="dashboard-menages" class="calou-text-sm">
                        <p class="calou-opacity-60">Chargement...</p>
                    </div>
                </div>

                <!-- Logistique Draps -->
                <div class="calou-card calou-p-6" style="border-left: 4px solid var(--calou-success); min-height: 200px;">
                    <div class="calou-flex calou-items-center calou-gap-2 calou-mb-4">
                        <i data-calou-icon="linen" data-size="lg" data-color="success"></i>
                        <h3 class="calou-text-base calou-font-bold calou-m-0 calou-text-success">Logistique Draps</h3>
                    </div>
                    <div id="dashboard-draps" class="calou-text-sm">
                        <p class="calou-opacity-60">Chargement...</p>
                    </div>
                </div>
            </div>
            
            <!-- COLONNE DROITE : TODO Lists par cat√©gorie -->
            <div class="calou-flex calou-flex-col calou-gap-6">
                <!-- TODO: Administratif -->
                <div class="calou-card calou-p-6">
                    <div class="calou-flex calou-items-center calou-justify-between calou-mb-4">
                        <div class="calou-flex calou-items-center calou-gap-2">
                            <i data-calou-icon="doc" data-size="md"></i>
                            <h3 class="calou-text-base calou-font-bold calou-m-0">Administratif</h3>
                        </div>
                        <button onclick="openAddTodoModal('administratif')" class="calou-btn-secondary calou-text-xs" style="padding: 4px 12px;">
                            <i data-calou-icon="plus" data-size="xs"></i>
                            Ajouter
                        </button>
                    </div>
                    <div id="todo-administratif" class="calou-flex calou-flex-col calou-gap-2">
                        <p class="calou-text-sm calou-opacity-60">Aucune t√¢che</p>
                    </div>
                </div>

                <!-- TODO: Maintenance -->
                <div class="calou-card calou-p-6">
                    <div class="calou-flex calou-items-center calou-justify-between calou-mb-4">
                        <div class="calou-flex calou-items-center calou-gap-2">
                            <i data-calou-icon="settings" data-size="md"></i>
                            <h3 class="calou-text-base calou-font-bold calou-m-0">Maintenance</h3>
                        </div>
                        <button onclick="openAddTodoModal('maintenance')" class="calou-btn-secondary calou-text-xs" style="padding: 4px 12px;">
                            <i data-calou-icon="plus" data-size="xs"></i>
                            Ajouter
                        </button>
                    </div>
                    <div id="todo-maintenance" class="calou-flex calou-flex-col calou-gap-2">
                        <p class="calou-text-sm calou-opacity-60">Aucune t√¢che</p>
                    </div>
                </div>

                <!-- TODO: Courses -->
                <div class="calou-card calou-p-6">
                    <div class="calou-flex calou-items-center calou-justify-between calou-mb-4">
                        <div class="calou-flex calou-items-center calou-gap-2">
                            <i data-calou-icon="home" data-size="md"></i>
                            <h3 class="calou-text-base calou-font-bold calou-m-0">Courses & Achats</h3>
                        </div>
                        <button onclick="openAddTodoModal('courses')" class="calou-btn-secondary calou-text-xs" style="padding: 4px 12px;">
                            <i data-calou-icon="plus" data-size="xs"></i>
                            Ajouter
                        </button>
                    </div>
                    <div id="todo-courses" class="calou-flex calou-flex-col calou-gap-2">
                        <p class="calou-text-sm calou-opacity-60">Aucune t√¢che</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Ajout T√¢che -->
<div id="addTodoModal" class="modal">
    <div class="modal-content">
        <div class="calou-card-header calou-mb-4">
            <div class="calou-flex calou-items-center calou-gap-2">
                <i data-calou-icon="plus" data-size="md"></i>
                <h2 class="calou-text-lg calou-font-bold calou-m-0">Nouvelle T√¢che</h2>
            </div>
        </div>
        
        <form id="addTodoForm">
            <input type="hidden" id="todoCategory">
            
            <div class="form-group calou-mb-4">
                <label class="calou-text-sm calou-font-bold calou-mb-2" style="display: block;">Titre <span style="color: var(--calou-error);">*</span></label>
                <input type="text" id="todoTitle" class="calou-w-full" style="padding: 10px; border: 2px solid var(--calou-border); border-radius: 8px;" placeholder="Ex: R√©parer robinet" required>
            </div>
            
            <div class="form-group calou-mb-4">
                <label class="calou-text-sm calou-font-bold calou-mb-2" style="display: block;">Description</label>
                <textarea id="todoDescription" rows="3" class="calou-w-full" style="padding: 10px; border: 2px solid var(--calou-border); border-radius: 8px;" placeholder="D√©tails suppl√©mentaires..."></textarea>
            </div>
            
            <div id="giteSelectGroup" class="form-group calou-mb-4" style="display: none;">
                <label class="calou-text-sm calou-font-bold calou-mb-2" style="display: block;">G√Æte concern√©</label>
                <select id="todoGite" class="calou-w-full" style="padding: 10px; border: 2px solid var(--calou-border); border-radius: 8px;">
                    <option value="">Non sp√©cifi√©</option>
                    <option value="Trevoux">Trevoux</option>
                    <option value="Couzon">Couzon</option>
                </select>
            </div>
            
            <div class="form-group calou-mb-4">
                <label class="calou-flex calou-items-center calou-gap-2" style="cursor: pointer;">
                    <input type="checkbox" id="todoRecurrent" style="width: 18px; height: 18px;">
                    <span class="calou-text-sm"><i data-calou-icon="sync" data-size="xs"></i> T√¢che r√©currente</span>
                </label>
            </div>
            
            <div id="recurrentOptions" style="display: none; margin-left: 26px;" class="calou-mt-4">
                <div class="form-group calou-mb-4">
                    <label class="calou-text-sm calou-font-bold calou-mb-2" style="display: block;">Fr√©quence</label>
                    <select id="todoFrequency" class="calou-w-full" style="padding: 10px; border: 2px solid var(--calou-border); border-radius: 8px;">
                        <option value="weekly">Hebdomadaire</option>
                        <option value="biweekly">Bimensuelle (2 semaines)</option>
                        <option value="monthly">Mensuelle</option>
                    </select>
                </div>
                
                <div id="weeklyOptions" class="form-group calou-mb-4">
                    <label class="calou-text-sm calou-font-bold calou-mb-2" style="display: block;">Jour de la semaine</label>
                    <select id="todoWeekday" class="calou-w-full" style="padding: 10px; border: 2px solid var(--calou-border); border-radius: 8px;">
                        <option value="1">Lundi</option>
                        <option value="2">Mardi</option>
                        <option value="3">Mercredi</option>
                        <option value="4">Jeudi</option>
                        <option value="5">Vendredi</option>
                        <option value="6">Samedi</option>
                        <option value="0">Dimanche</option>
                    </select>
                </div>
                
                <div id="monthlyOptions" class="form-group calou-mb-4" style="display: none;">
                    <label class="calou-text-sm calou-font-bold calou-mb-2" style="display: block;">Jour du mois</label>
                    <input type="number" id="todoDayOfMonth" min="1" max="31" value="1" class="calou-w-full" style="padding: 10px; border: 2px solid var(--calou-border); border-radius: 8px;">
                </div>
            </div>
            
            <div class="calou-flex calou-gap-3 calou-mt-6">
                <button type="submit" class="calou-btn-primary calou-flex-1">
                    <i data-calou-icon="check" data-size="sm"></i>
                    Cr√©er
                </button>
                <button type="button" class="calou-btn-secondary" onclick="closeAddTodoModal()">
                    Annuler
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal R√©ponse WhatsApp -->
<div id="reponseWhatsappModal" class="modal-overlay" style="display: none; align-items: flex-start; padding-top: 50px;">
    <div class="modal-content calou-card calou-p-6" style="max-width: 600px;">
        <div class="calou-flex calou-justify-between calou-items-center calou-mb-6">
            <h2 class="calou-text-lg calou-font-bold calou-m-0">
                <i data-calou-icon="user" data-size="md" class="calou-icon-spaced"></i>
                R√©pondre au client
            </h2>
            <button onclick="closeReponseWhatsappModal()" class="calou-text-2xl" style="background: none; border: none; cursor: pointer; opacity: 0.6;">√ó</button>
        </div>
        
        <div class="calou-card calou-card-success calou-p-4 calou-mb-6">
            <div class="calou-flex calou-items-center calou-gap-3 calou-mb-2">
                <i data-calou-icon="map" data-size="sm"></i>
                <strong id="reponseClientNom" class="calou-text-base">Client</strong>
                <span id="reponseClientGite" class="calou-badge calou-badge-success">G√Æte</span>
            </div>
            <div id="reponseClientSujet" class="calou-text-sm calou-opacity-80 calou-ml-8">Sujet de la demande</div>
        </div>
        
        <form id="formReponseWhatsapp">
            <input type="hidden" id="reponseProblemeId">
            <input type="hidden" id="reponseTelephone">
            
            <div class="form-group calou-mb-6">
                <label class="calou-text-sm calou-font-bold calou-mb-2" style="display: block;">Votre message</label>
                <textarea id="reponseMessage" rows="8" class="calou-w-full" style="padding: 12px; border: 2px solid var(--calou-border); border-radius: 8px; resize: vertical;" placeholder="√âcrivez votre r√©ponse ici..."></textarea>
            </div>
            
            <div class="calou-flex calou-gap-3">
                <button type="submit" class="calou-btn-primary calou-flex-1 calou-flex calou-items-center calou-justify-center calou-gap-2">
                    <i data-calou-icon="user" data-size="sm"></i>
                    Envoyer via WhatsApp
                </button>
                <button type="button" onclick="closeReponseWhatsappModal()" class="calou-btn-secondary">
                    Annuler
                </button>
            </div>
        </form>
    </div>
</div>
